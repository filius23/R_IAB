{
  "hash": "6ed638b5ecabf08f50cfc191bb7421cd",
  "result": {
    "markdown": "# Regressionsmodelle: Erweiterungen\n\n\n\n\n\nNach den basics für Regressionsmodelle sehen wir uns in diesem Kapitel einige hilfreiche Erweiterungen von Regressionsmodellen in R an.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\ndat1 <- data.frame(id   = 1:8,\n                   var1 = c(2,1,2,5,7, 8, 9,5),\n                   var2 = c(2,2,1,9,7, 4,25,3),\n                   educ = c(3,1,2,2,1, 3, 2,-1),\n                   gend = c(2,1,1,2,1,2,1,2),\n                   x    = c(2,1,2,4,1,NA,NA,NA) )\ndat1$ed_fct <- factor(dat1$educ, levels = 1:3,\n                        labels = c(\"basic\",\"medium\",\"high\"))\ndat1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  id var1 var2 educ gend  x ed_fct\n1  1    2    2    3    2  2   high\n2  2    1    2    1    1  1  basic\n3  3    2    1    2    1  2 medium\n4  4    5    9    2    2  4 medium\n5  5    7    7    1    1  1  basic\n6  6    8    4    3    2 NA   high\n7  7    9   25    2    1 NA medium\n8  8    5    3   -1    2 NA   <NA>\n```\n:::\n:::\n\n\n\n+ [vollständige Zeilen mit `complete.cases()`](#complcses) -> `e(sample)` in Stata\n+ [Interaktionen](#inter) -> `c.var1##c.var2` in Stata\n+ [Quadratische Terme](#quad) -> `c.var1##c.var1` in Stata\n+ [Gewichte anwenden](#gew) \n+ [Robuste Standardfehler](#rbst)\n+ [Fixed Effects Modelle](#fe)\n+ [Mehrebenenmodelle](#mlvl)\n\n## Nur vollständige Zeilen behalten {#complcses}\n\nWenn wir die beiden Modelle `m1` und `m3` vergleichen, sehen wir unterschiedliche Fallzahlen:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1 <- lm(var2~ var1, data = dat1)  \nm4 <- lm(var2 ~ ed_fct  + var1, dat1)\nmodelsummary(list(\"m1\"=m1,\"m4\"=m4),gof_omit = \"IC|RM|Log|F\",output = \"flextable\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-1358738a{}.cl-134f6c2c{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-135309ae{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-135321be{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-135321c8{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-135321c9{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-135321d2{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-1358738a'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-135321be\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\"> </span></p></th><th class=\"cl-135321be\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">m1</span></p></th><th class=\"cl-135321be\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">m4</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">(Intercept)</span></p></td><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">-2.340</span></p></td><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">-2.511</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\"></span></p></td><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">(4.345)</span></p></td><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">(5.681)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">var1</span></p></td><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">1.839</span></p></td><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">1.753</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\"></span></p></td><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">(0.773)</span></p></td><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">(0.835)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">ed_fctmedium</span></p></td><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\"></span></p></td><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">4.830</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\"></span></p></td><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\"></span></p></td><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">(6.038)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">ed_fcthigh</span></p></td><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\"></span></p></td><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">-3.253</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\"></span></p></td><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\"></span></p></td><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">(6.554)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-135321c9\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">Num.Obs.</span></p></td><td class=\"cl-135321c9\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">8</span></p></td><td class=\"cl-135321c9\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">7</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">R2</span></p></td><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">0.486</span></p></td><td class=\"cl-135321c8\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">0.700</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-135321d2\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">R2 Adj.</span></p></td><td class=\"cl-135321d2\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">0.400</span></p></td><td class=\"cl-135321d2\"><p class=\"cl-135309ae\"><span class=\"cl-134f6c2c\">0.400</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n\nEs zeigt sich, dass in Modell `m4` mit `edu_fct` 1 Fall verloren geht. Woran liegt das?\nDazu lohnt sich ein Blick in die Daten:\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  id var1 var2 educ gend  x ed_fct\n1  1    2    2    3    2  2   high\n2  2    1    2    1    1  1  basic\n3  3    2    1    2    1  2 medium\n4  4    5    9    2    2  4 medium\n5  5    7    7    1    1  1  basic\n6  6    8    4    3    2 NA   high\n7  7    9   25    2    1 NA medium\n8  8    5    3   -1    2 NA   <NA>\n```\n:::\n:::\n\n\nDie Angabe für `ed_fct` fehlt in für `id` = 8.\n\nUm die Modelle zu vergleichen sollten wir also nur die Zeilen verwenden, für die auch die Werte für `ed_fct` vorliegen.\nHier können wir diese Zeilen per Hand auswählen (und `id`=8 ausschließen), in größeren Datensätzen ist das aber mühsam.\n\n### `complete.cases()`\n\nHier hilft uns `complete.cases()`.\nDiese Funktion erstellt eine logische Variable, welche ein `TRUE` für alle vollständigen Fälle (also ohne ein `NA`). \nUnvollständige Fälle werden mit einem `FALSE` versehen. \nDazu geben wir an, welche Variablen jeweils für diese Betrachtung berücksichtigt werden sollen und legen die Variable einfach im Datensatz als neue Spalte an. \nFür Modell 1 ist ein Fall `complete`, wenn `var2` und `var1` vorliegen. \nWir wählen also mit `select()` die relevanten Variablen aus und wenden `complete.cases` auf diese Auswahl an:\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1 %>% select(var1,var2) %>% complete.cases(.) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE\n```\n:::\n\n```{.r .cell-code}\ndat1$compl_m1 <- dat1 %>% select(var1,var2) %>% complete.cases(.) \ndat1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  id var1 var2 educ gend  x ed_fct compl_m1\n1  1    2    2    3    2  2   high     TRUE\n2  2    1    2    1    1  1  basic     TRUE\n3  3    2    1    2    1  2 medium     TRUE\n4  4    5    9    2    2  4 medium     TRUE\n5  5    7    7    1    1  1  basic     TRUE\n6  6    8    4    3    2 NA   high     TRUE\n7  7    9   25    2    1 NA medium     TRUE\n8  8    5    3   -1    2 NA   <NA>     TRUE\n```\n:::\n:::\n\n::: {.callout-warning collapse=\"true\"}\n# `complete.cases()` alleine sucht in allen Variablen nach `NA`\nAchtung: wenn wir keine Variablen angeben, werden `NA` aus allen Variablen berücksichtigt, hier also auch die `NA` aus `x` - die uns hier nicht interessieren:\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1 %>% complete.cases(.) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE\n```\n:::\n\n```{.r .cell-code}\ndat1$compl <- dat1 %>% complete.cases(.) \ndat1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  id var1 var2 educ gend  x ed_fct compl_m1 compl\n1  1    2    2    3    2  2   high     TRUE  TRUE\n2  2    1    2    1    1  1  basic     TRUE  TRUE\n3  3    2    1    2    1  2 medium     TRUE  TRUE\n4  4    5    9    2    2  4 medium     TRUE  TRUE\n5  5    7    7    1    1  1  basic     TRUE  TRUE\n6  6    8    4    3    2 NA   high     TRUE FALSE\n7  7    9   25    2    1 NA medium     TRUE FALSE\n8  8    5    3   -1    2 NA   <NA>     TRUE FALSE\n```\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\n:::\n\n...das gleiche machen wir für Modell `m4`, welches neben `var2` und `var1` ja auch noch `ed_fct` enthält:\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1$compl_m4 <- dat1 %>% select(var1,var2,ed_fct) %>% complete.cases(.)\n```\n:::\n\n\nSo sieht das dann im Datensatz aus:\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  id var1 var2 educ gend  x ed_fct compl_m1 compl_m4\n1  1    2    2    3    2  2   high     TRUE     TRUE\n2  2    1    2    1    1  1  basic     TRUE     TRUE\n3  3    2    1    2    1  2 medium     TRUE     TRUE\n4  4    5    9    2    2  4 medium     TRUE     TRUE\n5  5    7    7    1    1  1  basic     TRUE     TRUE\n6  6    8    4    3    2 NA   high     TRUE     TRUE\n7  7    9   25    2    1 NA medium     TRUE     TRUE\n8  8    5    3   -1    2 NA   <NA>     TRUE    FALSE\n```\n:::\n:::\n\n\n\n\n\n### Fälle mit missings finden\nJetzt können wir nach diesen Variablen filtern und uns diese Fälle genauer ansehen. Dazu filtern wir nach den Fällen, die zwar in `m1` enthalten (also `compl_m1` = `TRUE`) sind, aber nicht in `m4` (`compl_m4` = `FALSE`):\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1 %>% filter(compl_m1 == T & compl_m4 == F) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  id var1 var2 educ gend  x ed_fct compl_m1 compl_m4\n1  8    5    3   -1    2 NA   <NA>     TRUE    FALSE\n```\n:::\n:::\n\n\n### Modelle nur mit vollständigen Fällen berechnen\nAußerdem können wir jetzt auch das Modell `m1` so erstellen, dass wir nur die Fälle miteinbeziehen, die auch in Modell2 berücksichtigt werden:\n\n::: {.cell}\n\n```{.r .cell-code}\nm1_m4vars <- lm(var2 ~ var1     , data = filter(dat1,compl_m4 == T))\nmodelsummary(list(\"m1\"=m1,\"m1 mit m4vars\"=m1_m4vars,\"m4\"=m4),gof_omit = \"IC|RM|Log|F\",output = \"flextable\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-1623eb1c{}.cl-161b7bee{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-161eafc6{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-161ec1b4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-161ec1b5{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-161ec1be{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-161ec1bf{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-1623eb1c'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-161ec1b4\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\"> </span></p></th><th class=\"cl-161ec1b4\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">m1</span></p></th><th class=\"cl-161ec1b4\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">m1 mit m4vars</span></p></th><th class=\"cl-161ec1b4\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">m4</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">(Intercept)</span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">-2.340</span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">-1.832</span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">-2.511</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\"></span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">(4.345)</span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">(4.646)</span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">(5.681)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">var1</span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">1.839</span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">1.848</span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">1.753</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\"></span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">(0.773)</span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">(0.814)</span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">(0.835)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">ed_fctmedium</span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\"></span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\"></span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">4.830</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\"></span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\"></span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\"></span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">(6.038)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">ed_fcthigh</span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\"></span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\"></span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">-3.253</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\"></span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\"></span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\"></span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">(6.554)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-161ec1be\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">Num.Obs.</span></p></td><td class=\"cl-161ec1be\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">8</span></p></td><td class=\"cl-161ec1be\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">7</span></p></td><td class=\"cl-161ec1be\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">7</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">R2</span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">0.486</span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">0.508</span></p></td><td class=\"cl-161ec1b5\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">0.700</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-161ec1bf\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">R2 Adj.</span></p></td><td class=\"cl-161ec1bf\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">0.400</span></p></td><td class=\"cl-161ec1bf\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">0.409</span></p></td><td class=\"cl-161ec1bf\"><p class=\"cl-161eafc6\"><span class=\"cl-161b7bee\">0.400</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nJetzt haben wir also in `m1 mit m4vars` und `m4` die gleiche Fallzahl und können so die Ergebnisse direkt miteinander vergleichen.\n\n## Interaktionen {#inter}\n\nInteraktionen zwischen zwei Variablen können wir mit `*` berechnen:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1$g_fct <- factor(dat1$gend,levels = 1:2,\n                     labels = c(\"women\",\"men\"))\nm5 <- lm(var2 ~ var1 * g_fct, dat1)\nsummary(m5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = var2 ~ var1 * g_fct, data = dat1)\n\nResiduals:\n      1       2       3       4       5       6       7       8 \n-1.5000  2.6145 -0.8827  4.5000 -7.3687 -1.5000  5.6369 -1.5000 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)  \n(Intercept)    -3.1117     4.7702  -0.652   0.5498  \nvar1            2.4972     0.8211   3.041   0.0384 *\ng_fctmen        5.9451     8.4973   0.700   0.5227  \nvar1:g_fctmen  -2.1639     1.5331  -1.411   0.2310  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 5.493 on 4 degrees of freedom\nMultiple R-squared:  0.7244,\tAdjusted R-squared:  0.5177 \nF-statistic: 3.504 on 3 and 4 DF,  p-value: 0.1286\n```\n:::\n:::\n\nInteraktionen sollten immer visualisiert werden.\nDafür ist [`{ggeffects}`](https://strengejacke.github.io/ggeffects/index.html) eine große Hilfe:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfdz_install(\"ggeffects\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggeffects)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Paket 'ggeffects' wurde unter R Version 4.2.3 erstellt\n```\n:::\n\n```{.r .cell-code}\nggpredict(m5, terms = c(\"var1\",\"g_fct[women,men]\")) %>% plot()\n```\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-15-1.png){width=80% height=60%}\n:::\n\n```{.r .cell-code}\n# oder nebeneinander:\nggpredict(m5, terms = c(\"var1\",\"g_fct[women,men]\")) %>% plot(facet=TRUE)\n```\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-15-2.png){width=80% height=60%}\n:::\n:::\n\n\nWir können diese Darstellung mit den bekannten `{ggplot2}`-Befehlen verändern:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggpredict(m5, terms = c(\"var1\",\"g_fct[women,men]\")) %>% plot() + \n  scale_color_manual(values = c(\"orange\",\"lightskyblue3\"),breaks = c(\"women\",\"men\"),labels=c(\"Frauen\",\"Männer\")) +\n  scale_fill_manual(values = c(\"orange\",\"lightskyblue3\"),breaks = c(\"women\",\"men\"),labels=c(\"Frauen\",\"Männer\")) +\n  labs(title = \"Vorhergesagte Werte für var2\",\n       color = \"Gender\",\n       x = \"Werte für var1\",\n       y = \"Vorhergesagte Werte für var1\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nScale for colour is already present.\nAdding another scale for colour, which will replace the existing scale.\n```\n:::\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-16-1.png){width=60% height=60%}\n:::\n:::\n\n**[Alternativ können wir den \"marginsplot\" auch Schritt für Schritt selber erstellen](#marginsplot)**\n\n\n## Quadratische Terme & Polynome {#quad}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm6 <- lm(var2 ~ var1 + I(var1^2), dat1 %>% filter(id != 7))\nsummary(m6)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = var2 ~ var1 + I(var1^2), data = dat1 %>% filter(id != \n    7))\n\nResiduals:\n      1       2       3       4       5       6       7 \n-0.5443  1.4334 -1.5443  3.2043  1.2713 -1.0248 -2.7957 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)\n(Intercept)  -1.8580     3.4066  -0.545    0.614\nvar1          2.6481     1.9083   1.388    0.238\nI(var1^2)    -0.2235     0.2110  -1.059    0.349\n\nResidual standard error: 2.524 on 4 degrees of freedom\nMultiple R-squared:  0.5099,\tAdjusted R-squared:  0.2648 \nF-statistic: 2.081 on 2 and 4 DF,  p-value: 0.2402\n```\n:::\n:::\n\n\nAuch hier hilft `ggpredict()` bei der Visualisierung:\n\n::: {.cell}\n\n```{.r .cell-code}\nggpredict(m6, terms = c(\"var1\")) %>% plot()\n```\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-19-1.png){width=60% height=60%}\n:::\n:::\n\n\n## Gewichtetes Regressionsmodell {#gew}\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survey)\npend <- haven::read_dta(\"./orig/PENDDAT_cf_W13.dta\") %>% filter(netges > 0 , palter > 0, azges1 > 0) %>% \n  mutate(zpsex_fct = factor(zpsex, levels = 1:2, labels = c(\"M\",\"W\")))\nwgt_df <- haven::read_dta(\"./orig/pweights_cf_W13.dta\")\npend_wgt <- pend %>% left_join(wgt_df, by = join_by(pnr,welle))\n\n\nmodx <- lm(netges ~ palter + I(palter^2),data=pend)\n\npend_weighted <- svydesign(id      = ~pnr,\n                           weights = ~wqp,\n                           data    = pend_wgt)\n\n# family = gaussian() bekommen wir ein lineares Regressionsmodell, wie bei lm() - mit gewichtet\nsurvey_modx <- svyglm(netges ~ palter + I(palter^2), \n                    family = gaussian(), data = etb18,design = pend_weighted)\n\nmodelsummary(list(\"lm()\"=modx,\"svyglm()\"= survey_modx),gof_omit = \"RM|IC|Log\",output = \"flextable\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-1f46cb56{}.cl-1f3f01dc{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-1f420f9e{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-1f422128{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1f422132{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1f422133{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1f42213c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-1f46cb56'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-1f422128\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\"> </span></p></th><th class=\"cl-1f422128\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">lm()</span></p></th><th class=\"cl-1f422128\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">svyglm()</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">(Intercept)</span></p></td><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">811.753</span></p></td><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">463.721</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\"></span></p></td><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">(354.363)</span></p></td><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">(504.015)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">palter</span></p></td><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">24.640</span></p></td><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">53.580</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\"></span></p></td><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">(17.071)</span></p></td><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">(26.471)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">I(palter^2)</span></p></td><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">-0.147</span></p></td><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">-0.489</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\"></span></p></td><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">(0.197)</span></p></td><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">(0.314)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-1f422133\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">Num.Obs.</span></p></td><td class=\"cl-1f422133\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">7996</span></p></td><td class=\"cl-1f422133\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">7996</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">R2</span></p></td><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">0.004</span></p></td><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">0.007</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">R2 Adj.</span></p></td><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">0.004</span></p></td><td class=\"cl-1f422132\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">-2.252</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-1f42213c\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">F</span></p></td><td class=\"cl-1f42213c\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">15.525</span></p></td><td class=\"cl-1f42213c\"><p class=\"cl-1f420f9e\"><span class=\"cl-1f3f01dc\">8.495</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n## \"Robuste\" Standardfehler {#rbst}\n\n\nHäufig müssen die Standardfehler an Verstöße gegen die allgemeinen Annahmen (Homoskedastizität usw.) angepasst werden.\n\nDie gute Nachricht ist, dass R eine ganze Reihe an Möglichkeiten bietet, Standard-Fehler zu korrigieren.\nUnter anderem mit [{sandwich}](http://sandwich.r-forge.r-project.org/articles/sandwich.html) oder [{estimatr}](https://declaredesign.org/r/estimatr/articles/getting-started.html).\n\nEine sehr einfache Variante ist die Korrektur von Standardfehlern in `{modelsummary}`, die wir uns etwas genauer ansehen:\n\n\nWir können sog. *heteroskedasticity-consistent* (HC) \"robuste\" Standardfehler mit der `vcov`-Option `HC` in `modelsummary()` anfordern. \nDie Hilfe-Seite für `{modelsummary}` bietet eine [Liste mit allen Optionen](https://vincentarelbundock.github.io/modelsummary/articles/modelsummary.html#vcov).\n\nEine Option ist auch `stata`, um Ergebnisse aus Statas `, robust` zu replizieren. \n[Hier mehr](https://declaredesign.org/r/estimatr/articles/stata-wls-hat.html) zu den Hintergründen und Unterschieden.\n\nBasierend auf [den oben eingelesenen Daten](#gew) können wir folgendes Modell schätzen:\n\n::: {.cell}\n\n```{.r .cell-code}\nmod1 <- lm(netges ~ palter + I(palter^2),data=pend) \n\nlibrary(modelsummary)\nmodelsummary(list(mod1,mod1,mod1,mod1),vcov = c(\"classical\",\"HC\",\"HC2\",\"stata\"),gof_omit = \"RM|IC|Log\",output = \"flextable\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-2029544e{}.cl-20204be2{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-20239734{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-2023a9e0{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2023a9ea{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2023a9eb{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2023a9f4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-2029544e'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-2023a9e0\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\"> </span></p></th><th class=\"cl-2023a9e0\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">(1)</span></p></th><th class=\"cl-2023a9e0\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">(2)</span></p></th><th class=\"cl-2023a9e0\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">(3)</span></p></th><th class=\"cl-2023a9e0\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">(4)</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">(Intercept)</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">811.753</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">811.753</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">811.753</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">811.753</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\"></span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">(354.363)</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">(171.599)</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">(171.543)</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">(171.520)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">palter</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">24.640</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">24.640</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">24.640</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">24.640</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\"></span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">(17.071)</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">(8.923)</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">(8.920)</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">(8.919)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">I(palter^2)</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">-0.147</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">-0.147</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">-0.147</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">-0.147</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\"></span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">(0.197)</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">(0.112)</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">(0.112)</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">(0.112)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2023a9eb\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">Num.Obs.</span></p></td><td class=\"cl-2023a9eb\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">7996</span></p></td><td class=\"cl-2023a9eb\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">7996</span></p></td><td class=\"cl-2023a9eb\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">7996</span></p></td><td class=\"cl-2023a9eb\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">7996</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">R2</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">0.004</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">0.004</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">0.004</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">0.004</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">R2 Adj.</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">0.004</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">0.004</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">0.004</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">0.004</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">F</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">15.525</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">23.449</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">23.441</span></p></td><td class=\"cl-2023a9ea\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">23.440</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2023a9f4\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">Std.Errors</span></p></td><td class=\"cl-2023a9f4\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">IID</span></p></td><td class=\"cl-2023a9f4\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">HC</span></p></td><td class=\"cl-2023a9f4\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">HC2</span></p></td><td class=\"cl-2023a9f4\"><p class=\"cl-20239734\"><span class=\"cl-20204be2\">HC1</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nFür geclusterste SE geben wir `~clustervariable` an;\n\n::: {.cell}\n\n```{.r .cell-code}\nmodelsummary(mod1, vcov = c(\"classical\",~pnr), stars = T,gof_omit = \"RM|IC|Log|F\",output = \"flextable\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-20c4cd7a{}.cl-20bcc472{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-20c00452{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-20c01ff0{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-20c02004{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-20c02005{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-20c0200e{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-20c0200f{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-20c4cd7a'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-20c01ff0\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\"> </span></p></th><th class=\"cl-20c01ff0\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">(1)</span></p></th><th class=\"cl-20c01ff0\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">(2)</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">(Intercept)</span></p></td><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">811.753*</span></p></td><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">811.753**</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\"></span></p></td><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">(354.363)</span></p></td><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">(274.972)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">palter</span></p></td><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">24.640</span></p></td><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">24.640+</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\"></span></p></td><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">(17.071)</span></p></td><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">(14.475)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">I(palter^2)</span></p></td><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">-0.147</span></p></td><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">-0.147</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\"></span></p></td><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">(0.197)</span></p></td><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">(0.185)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-20c02005\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">Num.Obs.</span></p></td><td class=\"cl-20c02005\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">7996</span></p></td><td class=\"cl-20c02005\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">7996</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">R2</span></p></td><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">0.004</span></p></td><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">0.004</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">R2 Adj.</span></p></td><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">0.004</span></p></td><td class=\"cl-20c02004\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">0.004</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-20c0200e\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">Std.Errors</span></p></td><td class=\"cl-20c0200e\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">IID</span></p></td><td class=\"cl-20c0200e\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">by: pnr</span></p></td></tr></tbody><tfoot><tr style=\"overflow-wrap:break-word;\"><td  colspan=\"3\"class=\"cl-20c0200f\"><p class=\"cl-20c00452\"><span class=\"cl-20bcc472\">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</span></p></td></tr></tfoot></table></div>\n```\n:::\n:::\n\n\n## Fixed effects Modelle mit `{fixest}` {#fe}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfdz_install(\"fixest\")\n```\n:::\n\n\n[`{fixest}`](https://lrberge.github.io/fixest)) bietet eine große Auswahl an Möglichkeiten: [logistische FE-Modelle](#10_log_reg.qmd##feglm), mehr-dimensionale Fixed Effects, Multiway clustering, ...\nUnd es ist sehr schnell, [bspw. schneller](https://lrberge.github.io/fixest/#benchmarking) als Statas `reghdfe`. \nFür mehr Details empfiehlt sich die [Vignette](https://lrberge.github.io/fixest/articles/fixest_walkthrough.html).\n\nDie zentrale Funktion zur Schätzung linearer FE-Regressionsmodelle ist `feols()` - sie funktioniert ganz ähnlich zu `lm()`. \nAuch hier geben wir wieder eine Formel nach dem Schema `abhängige Variabe ~ unabhängige Variable(n)` an. \nWir fügen lediglich mit `|` die Variable hinzu, welche die FEs festlegt:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(fixest)\nfe_mod1 <- feols(netges ~ palter + I(palter^2) | pnr, data = pend)\nfe_mod1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOLS estimation, Dep. Var.: netges\nObservations: 7,996 \nFixed-effects: pnr: 2,444\nStandard-errors: Clustered (pnr) \n              Estimate Std. Error  t value   Pr(>|t|)    \npalter      133.811281  14.558248  9.19144  < 2.2e-16 ***\nI(palter^2)  -0.848429   0.154417 -5.49441 4.3261e-08 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nRMSE: 1,222.2     Adj. R2: 0.513287\n                Within R2: 0.009765\n```\n:::\n:::\n\n\n`{fixest}` clustert automatisch die Standardfehler entlang der FE-Variable (hier also `pnr`).\nWenn wir das mal nicht möchten, können wir mit der `se`-Option `= \"standard\"` ungeclusterte SE anfordern:\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(fe_mod1, se = 'standard')\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOLS estimation, Dep. Var.: netges\nObservations: 7,996 \nFixed-effects: pnr: 2,444\nStandard-errors: IID \n              Estimate Std. Error  t value   Pr(>|t|)    \npalter      133.811281  39.896986  3.35392 0.00080209 ***\nI(palter^2)  -0.848429   0.429629 -1.97479 0.04834109 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nRMSE: 1,222.2     Adj. R2: 0.513287\n                Within R2: 0.009765\n```\n:::\n\n```{.r .cell-code}\nsummary(fe_mod1, cluster = ~pnr)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOLS estimation, Dep. Var.: netges\nObservations: 7,996 \nFixed-effects: pnr: 2,444\nStandard-errors: Clustered (pnr) \n              Estimate Std. Error  t value   Pr(>|t|)    \npalter      133.811281  14.558248  9.19144  < 2.2e-16 ***\nI(palter^2)  -0.848429   0.154417 -5.49441 4.3261e-08 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nRMSE: 1,222.2     Adj. R2: 0.513287\n                Within R2: 0.009765\n```\n:::\n:::\n\n\n`{modelsummary}` zeigt die geclusterten SE:\n\n::: {.cell}\n\n```{.r .cell-code}\nmodelsummary(fe_mod1,gof_omit = \"R|IC|Log|F\",stars = T,output = \"flextable\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-22433ce0{}.cl-221af69a{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-223e359c{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-223e51bc{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-223e51c6{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-223e51d0{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-223e51d1{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-223e51da{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-22433ce0'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-223e51bc\"><p class=\"cl-223e359c\"><span class=\"cl-221af69a\"> </span></p></th><th class=\"cl-223e51bc\"><p class=\"cl-223e359c\"><span class=\"cl-221af69a\">(1)</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-223e51c6\"><p class=\"cl-223e359c\"><span class=\"cl-221af69a\">palter</span></p></td><td class=\"cl-223e51c6\"><p class=\"cl-223e359c\"><span class=\"cl-221af69a\">133.811***</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-223e51c6\"><p class=\"cl-223e359c\"><span class=\"cl-221af69a\"></span></p></td><td class=\"cl-223e51c6\"><p class=\"cl-223e359c\"><span class=\"cl-221af69a\">(14.558)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-223e51c6\"><p class=\"cl-223e359c\"><span class=\"cl-221af69a\">I(palter^2)</span></p></td><td class=\"cl-223e51c6\"><p class=\"cl-223e359c\"><span class=\"cl-221af69a\">-0.848***</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-223e51c6\"><p class=\"cl-223e359c\"><span class=\"cl-221af69a\"></span></p></td><td class=\"cl-223e51c6\"><p class=\"cl-223e359c\"><span class=\"cl-221af69a\">(0.154)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-223e51d0\"><p class=\"cl-223e359c\"><span class=\"cl-221af69a\">Num.Obs.</span></p></td><td class=\"cl-223e51d0\"><p class=\"cl-223e359c\"><span class=\"cl-221af69a\">7996</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-223e51d1\"><p class=\"cl-223e359c\"><span class=\"cl-221af69a\">Std.Errors</span></p></td><td class=\"cl-223e51d1\"><p class=\"cl-223e359c\"><span class=\"cl-221af69a\">by: pnr</span></p></td></tr></tbody><tfoot><tr style=\"overflow-wrap:break-word;\"><td  colspan=\"2\"class=\"cl-223e51da\"><p class=\"cl-223e359c\"><span class=\"cl-221af69a\">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</span></p></td></tr></tfoot></table></div>\n```\n:::\n:::\n\n\n## Mehrebenenmodelle mit `{lme4}` {#mlvl}\n\n\nMit `lmer()` können wir ein Random Intercept Modell berechnen, indem wir mit `( 1 | pnr)` angeben, dass für `pnr` jeweils ein eigenes Random Intercept berechnet werden soll:\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lme4)\nml_m3 <- lmer(netges ~ palter + I(palter^2) + ( 1 | pnr), data=pend)\n\nmodelsummary(list(ml_m3),gof_omit = \"R|IC|Log|F\",output = \"flextable\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-2357fd6e{}.cl-234fe412{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-235309b2{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-23531bfa{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-23531c04{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-23531c05{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-2357fd6e'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-23531bfa\"><p class=\"cl-235309b2\"><span class=\"cl-234fe412\"> </span></p></th><th class=\"cl-23531bfa\"><p class=\"cl-235309b2\"><span class=\"cl-234fe412\">(1)</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-23531c04\"><p class=\"cl-235309b2\"><span class=\"cl-234fe412\">(Intercept)</span></p></td><td class=\"cl-23531c04\"><p class=\"cl-235309b2\"><span class=\"cl-234fe412\">754.388</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-23531c04\"><p class=\"cl-235309b2\"><span class=\"cl-234fe412\"></span></p></td><td class=\"cl-23531c04\"><p class=\"cl-235309b2\"><span class=\"cl-234fe412\">(392.459)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-23531c04\"><p class=\"cl-235309b2\"><span class=\"cl-234fe412\">palter</span></p></td><td class=\"cl-23531c04\"><p class=\"cl-235309b2\"><span class=\"cl-234fe412\">18.523</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-23531c04\"><p class=\"cl-235309b2\"><span class=\"cl-234fe412\"></span></p></td><td class=\"cl-23531c04\"><p class=\"cl-235309b2\"><span class=\"cl-234fe412\">(19.083)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-23531c04\"><p class=\"cl-235309b2\"><span class=\"cl-234fe412\">I(palter^2)</span></p></td><td class=\"cl-23531c04\"><p class=\"cl-235309b2\"><span class=\"cl-234fe412\">-0.020</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-23531c04\"><p class=\"cl-235309b2\"><span class=\"cl-234fe412\"></span></p></td><td class=\"cl-23531c04\"><p class=\"cl-235309b2\"><span class=\"cl-234fe412\">(0.222)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-23531c04\"><p class=\"cl-235309b2\"><span class=\"cl-234fe412\">SD (Intercept pnr)</span></p></td><td class=\"cl-23531c04\"><p class=\"cl-235309b2\"><span class=\"cl-234fe412\">1327.674</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-23531c04\"><p class=\"cl-235309b2\"><span class=\"cl-234fe412\">SD (Observations)</span></p></td><td class=\"cl-23531c04\"><p class=\"cl-235309b2\"><span class=\"cl-234fe412\">1414.455</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-23531c05\"><p class=\"cl-235309b2\"><span class=\"cl-234fe412\">Num.Obs.</span></p></td><td class=\"cl-23531c05\"><p class=\"cl-235309b2\"><span class=\"cl-234fe412\">7996</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nMehr zu Mehrebenenmodellen und `{lme4}` in Blogposts von [Rense Nieuwenhuis ](http://www.rensenieuwenhuis.nl/r-sessions-16-multilevel-model-specification-lme4/) und [Tristan Mahr](https://www.tjmahr.com/plotting-partial-pooling-in-mixed-effects-models/).\n\n\n<!-- ## Abschließende Bemerkungen -->\n\n<!-- Zusammengefasst lassen uns `{fixest}` und `{modelsummary}` Standardfehler nach der eigentlichen Modellschätzung anpassen, indem wir die  `se` or `cluster` Optionen verwenden.  -->\n\n<!-- Ein [Blog Post von Grant Mcdermott](https://grantmcdermott.com/better-way-adjust-SEs/) argumentiert noch etwas ausführlicher, warum die nachträgliche Berechnung der Standardfehler (anstelle einer kompletten Neuschätzung des Modells) eine gute Idee ist - auch wenn es für Stata-Nutzende ein sehr ungewöhnliches Vorgehen ist. -->\n\n<!-- Die exakte Replikation von Standardfehlern aus anderen Programmen (bspw, Stata) ist oft schwieriger als es zunächst scheint.  -->\n<!-- Siehe auch die Diskussion [hier](https://github.com/sgaure/lfe/issues/1#issuecomment-530643808)  -->\n<!-- [Detaillierte vignette](https://lrberge.github.io/fixest/articles/standard_errors.html) `{fixest}` wie SEs aus anderen Programmen repliziert werden können. -->\n<!-- [Detailliertes Paper](http://sandwich.r-forge.r-project.org/articles/jss_2020.html) von den Autoren von `{sandwich}` zu diesem Thema.  -->\n\n## Anhang: Predictions mit `marginaleffects` und \"manuelle\" Darstellung {#marginsplot}\n\nWir hatten im Kapitel [Interaktionen](#interaktionen) folgendes Modell geschätzt:\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(m5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = var2 ~ var1 * g_fct, data = dat1)\n\nResiduals:\n      1       2       3       4       5       6       7       8 \n-1.5000  2.6145 -0.8827  4.5000 -7.3687 -1.5000  5.6369 -1.5000 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)  \n(Intercept)    -3.1117     4.7702  -0.652   0.5498  \nvar1            2.4972     0.8211   3.041   0.0384 *\ng_fctmen        5.9451     8.4973   0.700   0.5227  \nvar1:g_fctmen  -2.1639     1.5331  -1.411   0.2310  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 5.493 on 4 degrees of freedom\nMultiple R-squared:  0.7244,\tAdjusted R-squared:  0.5177 \nF-statistic: 3.504 on 3 and 4 DF,  p-value: 0.1286\n```\n:::\n:::\n\n\nMit `predictions()` aus `{marginaleffects}` können wir basierend auf unserem Modell vorhergesagte Werte für bestimmte Werte berechnen.\nDazu geben wir die die gewünschten mit einem `datagrid()` an - dieses setzt automatisch die weiteren Variablen auf das arithm. Mittel:\n\n::: {.cell}\n\n```{.r .cell-code}\n# Kombinationen aller Werte erstellen\ndatagrid(var1 = 1:5,\n         g_fct =  c(\"women\",\"men\"),model = m5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n    var2 var1 g_fct\n1  6.625    1 women\n2  6.625    1   men\n3  6.625    2 women\n4  6.625    2   men\n5  6.625    3 women\n6  6.625    3   men\n7  6.625    4 women\n8  6.625    4   men\n9  6.625    5 women\n10 6.625    5   men\n```\n:::\n:::\n\n\nDiese Werte geben wir dann in `predictions()` als `newdata =` an:\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(marginaleffects)\np <- predictions(m5, \n                 newdata = datagrid(var1 = 1:5,\n                                    g_fct =  c(\"women\",\"men\"))) # ,model = m5 unnötig weil schon predictions angegeben:\n                 \nhead(data.frame(p))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  rowid   estimate std.error  statistic   p.value  conf.low conf.high  var2\n1     1 -0.6145251  4.126052 -0.1489378 0.8816027 -8.701438  7.472388 6.625\n2     2  3.1666667  5.861938  0.5402082 0.5890535 -8.322520 14.655853 6.625\n3     3  1.8826816  3.555532  0.5295076 0.5964533 -5.086034  8.851397 6.625\n4     4  3.5000000  4.756978  0.7357612 0.4618760 -5.823506 12.823506 6.625\n5     5  4.3798883  3.099641  1.4130307 0.1576467 -1.695297 10.455074 6.625\n6     6  3.8333333  3.774624  1.0155536 0.3098420 -3.564794 11.231461 6.625\n  var1 g_fct\n1    1 women\n2    1   men\n3    2 women\n4    2   men\n5    3 women\n6    3   men\n```\n:::\n:::\n\n\nFür den `ggplot()` verwenden wir dann `geom_line()` zusammen mit \n\n+ `geom_errorbar()` für eine Darstellung mit Konfidenzintervallen als Error Bars \n+ mit `geom_ribbon()` erhalten wir die Konfidenzintervalle als Konfidenzbänder (hier müssen wir mit `alpha = ` die Deckkraft der etwas heruntersetzen und die Farbe mit `fill=` angeben um den Bereich einzufärben). \n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\npred_plt <- \n    ggplot(data= data.frame(p),\n           aes(x = var1, \n               y =  estimate, \n               ymin = conf.low,ymax = conf.high,\n               color = g_fct)) + \n      geom_line() + \n      scale_color_manual(values = c(\"orange\",\"lightskyblue3\"),breaks = c(\"women\",\"men\"),labels=c(\"Frauen\",\"Männer\")) +\n      labs(title = \"Vorhergesagte Werte für var2\",\n           color = \"Gender\",\n           x = \"Werte für var1\",\n           y = \"Vorhergesagte Werte für var1\") +\n      theme_minimal()\n\n# Konfidenzintervalle\npred_plt + \n  geom_point(size = 2.75) +\n  geom_errorbar(width = .1)\n```\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-29-1.png){width=3500}\n:::\n\n```{.r .cell-code}\n# mit Konfidenzbändern\npred_plt + \n  geom_ribbon(alpha = .1, color = NA,aes(fill = g_fct)) +\n  scale_fill_manual(values = c(\"orange\",\"lightskyblue3\"),breaks = c(\"women\",\"men\"),labels=c(\"Frauen\",\"Männer\")) +\n  labs(fill = \"Gender\")\n```\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-29-2.png){width=3500}\n:::\n:::\n",
    "supporting": [
      "09_reg2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/tabwid-1.1.3/tabwid.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/tabwid-1.1.3/tabwid.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}