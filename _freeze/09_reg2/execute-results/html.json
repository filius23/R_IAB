{
  "hash": "2e606116ddbb5e1abe98e8256cd9e60b",
  "result": {
    "markdown": "# Regressionsmodelle: Erweiterungen\n\n\n\n\n\nNach den basics für Regressionsmodelle sehen wir uns in diesem Kapitel einige hilfreiche Erweiterungen von Regressionsmodellen in R an.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\ndat1 <- data.frame(id   = 1:8,\n                   var1 = c(2,1,2,5,7, 8, 9,5),\n                   var2 = c(2,2,1,9,7, 4,25,3),\n                   educ = c(3,1,2,2,1, 3, 2,-1),\n                   gend = c(2,1,1,2,1,2,1,2),\n                   x    = c(2,1,2,4,1,NA,NA,NA) )\ndat1$ed_fct <- factor(dat1$educ, levels = 1:3,\n                        labels = c(\"basic\",\"medium\",\"high\"))\ndat1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  id var1 var2 educ gend  x ed_fct\n1  1    2    2    3    2  2   high\n2  2    1    2    1    1  1  basic\n3  3    2    1    2    1  2 medium\n4  4    5    9    2    2  4 medium\n5  5    7    7    1    1  1  basic\n6  6    8    4    3    2 NA   high\n7  7    9   25    2    1 NA medium\n8  8    5    3   -1    2 NA   <NA>\n```\n:::\n:::\n\n\n\n+ [vollständige Zeilen mit `complete.cases()`](#complcses) -> `e(sample)` in Stata\n+ [Interaktionen](#inter) -> `c.var1##c.var2` in Stata\n+ [Quadratische Terme](#quad) -> `c.var1##c.var1` in Stata\n+ [Gewichte anwenden](#gew) \n+ [Robuste Standardfehler](#rbst)\n+ [Fixed Effects Modelle](#fe)\n+ [Mehrebenenmodelle](#mlvl)\n\n## Nur vollständige Zeilen behalten {#complcses}\n\nWenn wir die beiden Modelle `m1` und `m3` vergleichen, sehen wir unterschiedliche Fallzahlen:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1 <- lm(var2~ var1, data = dat1)  \nm4 <- lm(var2 ~ ed_fct  + var1, dat1)\nmodelsummary(list(\"m1\"=m1,\"m4\"=m4),gof_omit = \"IC|RM|Log|F\",output = \"flextable\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-21dc01e6{}.cl-21d16a56{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-21d59d60{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-21d5ba7a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-21d5ba84{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-21d5ba85{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-21d5ba8e{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-21dc01e6'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-21d5ba7a\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\"> </span></p></th><th class=\"cl-21d5ba7a\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">m1</span></p></th><th class=\"cl-21d5ba7a\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">m4</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">(Intercept)</span></p></td><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">-2.340</span></p></td><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">-2.511</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\"></span></p></td><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">(4.345)</span></p></td><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">(5.681)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">var1</span></p></td><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">1.839</span></p></td><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">1.753</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\"></span></p></td><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">(0.773)</span></p></td><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">(0.835)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">ed_fctmedium</span></p></td><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\"></span></p></td><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">4.830</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\"></span></p></td><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\"></span></p></td><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">(6.038)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">ed_fcthigh</span></p></td><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\"></span></p></td><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">-3.253</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\"></span></p></td><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\"></span></p></td><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">(6.554)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-21d5ba85\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">Num.Obs.</span></p></td><td class=\"cl-21d5ba85\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">8</span></p></td><td class=\"cl-21d5ba85\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">7</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">R2</span></p></td><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">0.486</span></p></td><td class=\"cl-21d5ba84\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">0.700</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-21d5ba8e\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">R2 Adj.</span></p></td><td class=\"cl-21d5ba8e\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">0.400</span></p></td><td class=\"cl-21d5ba8e\"><p class=\"cl-21d59d60\"><span class=\"cl-21d16a56\">0.400</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n\nEs zeigt sich, dass in Modell `m4` mit `edu_fct` 1 Fall verloren geht. Woran liegt das?\nDazu lohnt sich ein Blick in die Daten:\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  id var1 var2 educ gend  x ed_fct\n1  1    2    2    3    2  2   high\n2  2    1    2    1    1  1  basic\n3  3    2    1    2    1  2 medium\n4  4    5    9    2    2  4 medium\n5  5    7    7    1    1  1  basic\n6  6    8    4    3    2 NA   high\n7  7    9   25    2    1 NA medium\n8  8    5    3   -1    2 NA   <NA>\n```\n:::\n:::\n\n\nDie Angabe für `ed_fct` fehlt in für `id` = 8.\n\nUm die Modelle zu vergleichen sollten wir also nur die Zeilen verwenden, für die auch die Werte für `ed_fct` vorliegen.\nHier können wir diese Zeilen per Hand auswählen (und `id`=8 ausschließen), in größeren Datensätzen ist das aber mühsam.\n\n### `complete.cases()`\n\nHier hilft uns `complete.cases()`.\nDiese Funktion erstellt eine logische Variable, welche ein `TRUE` für alle vollständigen Fälle (also ohne ein `NA`). \nUnvollständige Fälle werden mit einem `FALSE` versehen. \nDazu geben wir an, welche Variablen jeweils für diese Betrachtung berücksichtigt werden sollen und legen die Variable einfach im Datensatz als neue Spalte an. \nFür Modell 1 ist ein Fall `complete`, wenn `var2` und `var1` vorliegen. \nWir wählen also mit `select()` die relevanten Variablen aus und wenden `complete.cases` auf diese Auswahl an:\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1 %>% select(var1,var2) %>% complete.cases(.) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE\n```\n:::\n\n```{.r .cell-code}\ndat1$compl_m1 <- dat1 %>% select(var1,var2) %>% complete.cases(.) \ndat1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  id var1 var2 educ gend  x ed_fct compl_m1\n1  1    2    2    3    2  2   high     TRUE\n2  2    1    2    1    1  1  basic     TRUE\n3  3    2    1    2    1  2 medium     TRUE\n4  4    5    9    2    2  4 medium     TRUE\n5  5    7    7    1    1  1  basic     TRUE\n6  6    8    4    3    2 NA   high     TRUE\n7  7    9   25    2    1 NA medium     TRUE\n8  8    5    3   -1    2 NA   <NA>     TRUE\n```\n:::\n:::\n\n::: {.callout-warning collapse=\"true\"}\n# `complete.cases()` alleine sucht in allen Variablen nach `NA`\nAchtung: wenn wir keine Variablen angeben, werden `NA` aus allen Variablen berücksichtigt, hier also auch die `NA` aus `x` - die uns hier nicht interessieren:\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1 %>% complete.cases(.) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE\n```\n:::\n\n```{.r .cell-code}\ndat1$compl <- dat1 %>% complete.cases(.) \ndat1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  id var1 var2 educ gend  x ed_fct compl_m1 compl\n1  1    2    2    3    2  2   high     TRUE  TRUE\n2  2    1    2    1    1  1  basic     TRUE  TRUE\n3  3    2    1    2    1  2 medium     TRUE  TRUE\n4  4    5    9    2    2  4 medium     TRUE  TRUE\n5  5    7    7    1    1  1  basic     TRUE  TRUE\n6  6    8    4    3    2 NA   high     TRUE FALSE\n7  7    9   25    2    1 NA medium     TRUE FALSE\n8  8    5    3   -1    2 NA   <NA>     TRUE FALSE\n```\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\n:::\n\n...das gleiche machen wir für Modell `m4`, welches neben `var2` und `var1` ja auch noch `ed_fct` enthält:\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1$compl_m4 <- dat1 %>% select(var1,var2,ed_fct) %>% complete.cases(.)\n```\n:::\n\n\nSo sieht das dann im Datensatz aus:\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  id var1 var2 educ gend  x ed_fct compl_m1 compl_m4\n1  1    2    2    3    2  2   high     TRUE     TRUE\n2  2    1    2    1    1  1  basic     TRUE     TRUE\n3  3    2    1    2    1  2 medium     TRUE     TRUE\n4  4    5    9    2    2  4 medium     TRUE     TRUE\n5  5    7    7    1    1  1  basic     TRUE     TRUE\n6  6    8    4    3    2 NA   high     TRUE     TRUE\n7  7    9   25    2    1 NA medium     TRUE     TRUE\n8  8    5    3   -1    2 NA   <NA>     TRUE    FALSE\n```\n:::\n:::\n\n\n\n\n\n### Fälle mit missings finden\nJetzt können wir nach diesen Variablen filtern und uns diese Fälle genauer ansehen. Dazu filtern wir nach den Fällen, die zwar in `m1` enthalten (also `compl_m1` = `TRUE`) sind, aber nicht in `m4` (`compl_m4` = `FALSE`):\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1 %>% filter(compl_m1 == T & compl_m4 == F) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  id var1 var2 educ gend  x ed_fct compl_m1 compl_m4\n1  8    5    3   -1    2 NA   <NA>     TRUE    FALSE\n```\n:::\n:::\n\n\n### Modelle nur mit vollständigen Fällen berechnen\nAußerdem können wir jetzt auch das Modell `m1` so erstellen, dass wir nur die Fälle miteinbeziehen, die auch in Modell2 berücksichtigt werden:\n\n::: {.cell}\n\n```{.r .cell-code}\nm1_m4vars <- lm(var2 ~ var1     , data = filter(dat1,compl_m4 == T))\nmodelsummary(list(\"m1\"=m1,\"m1 mit m4vars\"=m1_m4vars,\"m4\"=m4),gof_omit = \"IC|RM|Log|F\",output = \"flextable\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-2507b3b0{}.cl-24fdcc38{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-25019a34{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-2501b226{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2501b230{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2501b231{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2501b23a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-2507b3b0'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-2501b226\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\"> </span></p></th><th class=\"cl-2501b226\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">m1</span></p></th><th class=\"cl-2501b226\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">m1 mit m4vars</span></p></th><th class=\"cl-2501b226\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">m4</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">(Intercept)</span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">-2.340</span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">-1.832</span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">-2.511</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\"></span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">(4.345)</span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">(4.646)</span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">(5.681)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">var1</span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">1.839</span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">1.848</span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">1.753</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\"></span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">(0.773)</span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">(0.814)</span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">(0.835)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">ed_fctmedium</span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\"></span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\"></span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">4.830</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\"></span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\"></span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\"></span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">(6.038)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">ed_fcthigh</span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\"></span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\"></span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">-3.253</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\"></span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\"></span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\"></span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">(6.554)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2501b231\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">Num.Obs.</span></p></td><td class=\"cl-2501b231\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">8</span></p></td><td class=\"cl-2501b231\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">7</span></p></td><td class=\"cl-2501b231\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">7</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">R2</span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">0.486</span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">0.508</span></p></td><td class=\"cl-2501b230\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">0.700</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2501b23a\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">R2 Adj.</span></p></td><td class=\"cl-2501b23a\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">0.400</span></p></td><td class=\"cl-2501b23a\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">0.409</span></p></td><td class=\"cl-2501b23a\"><p class=\"cl-25019a34\"><span class=\"cl-24fdcc38\">0.400</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nJetzt haben wir also in `m1 mit m4vars` und `m4` die gleiche Fallzahl und können so die Ergebnisse direkt miteinander vergleichen.\n\n## Interaktionen {#inter}\n\nInteraktionen zwischen zwei Variablen können wir mit `*` berechnen:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1$g_fct <- factor(dat1$gend,levels = 1:2,\n                     labels = c(\"women\",\"men\"))\nm5 <- lm(var2 ~ var1 * g_fct, dat1)\nsummary(m5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = var2 ~ var1 * g_fct, data = dat1)\n\nResiduals:\n      1       2       3       4       5       6       7       8 \n-1.5000  2.6145 -0.8827  4.5000 -7.3687 -1.5000  5.6369 -1.5000 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)  \n(Intercept)    -3.1117     4.7702  -0.652   0.5498  \nvar1            2.4972     0.8211   3.041   0.0384 *\ng_fctmen        5.9451     8.4973   0.700   0.5227  \nvar1:g_fctmen  -2.1639     1.5331  -1.411   0.2310  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 5.493 on 4 degrees of freedom\nMultiple R-squared:  0.7244,\tAdjusted R-squared:  0.5177 \nF-statistic: 3.504 on 3 and 4 DF,  p-value: 0.1286\n```\n:::\n:::\n\n\nInteraktionen sollten immer visualisiert werden.\nDafür ist [`{ggeffects}`](https://strengejacke.github.io/ggeffects/index.html) eine große Hilfe:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"ggeffects\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggeffects)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Paket 'ggeffects' wurde unter R Version 4.2.3 erstellt\n```\n:::\n\n```{.r .cell-code}\nggpredict(m5, terms = c(\"var1\",\"g_fct[women,men]\")) %>% plot()\n```\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-15-1.png){width=80% height=60%}\n:::\n\n```{.r .cell-code}\n# oder nebeneinander:\nggpredict(m5, terms = c(\"var1\",\"g_fct[women,men]\")) %>% plot(facet=TRUE)\n```\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-15-2.png){width=80% height=60%}\n:::\n:::\n\n\nWir können diese Darstellung mit den bekannten `{ggplot2}`-Befehlen verändern:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggpredict(m5, terms = c(\"var1\",\"g_fct[women,men]\")) %>% plot() + \n  scale_color_manual(values = c(\"orange\",\"lightskyblue3\"),breaks = c(\"women\",\"men\"),labels=c(\"Frauen\",\"Männer\")) +\n  scale_fill_manual(values = c(\"orange\",\"lightskyblue3\"),breaks = c(\"women\",\"men\"),labels=c(\"Frauen\",\"Männer\")) +\n  labs(title = \"Vorhergesagte Werte für var2\",\n       color = \"Gender\",\n       x = \"Werte für var1\",\n       y = \"Vorhergesagte Werte für var1\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nScale for colour is already present.\nAdding another scale for colour, which will replace the existing scale.\n```\n:::\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-16-1.png){width=60% height=60%}\n:::\n:::\n\n\n## Quadratische Terme & Polynome {#quad}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm6 <- lm(var2 ~ var1 + I(var1^2), dat1 %>% filter(id != 7))\nsummary(m6)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = var2 ~ var1 + I(var1^2), data = dat1 %>% filter(id != \n    7))\n\nResiduals:\n      1       2       3       4       5       6       7 \n-0.5443  1.4334 -1.5443  3.2043  1.2713 -1.0248 -2.7957 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)\n(Intercept)  -1.8580     3.4066  -0.545    0.614\nvar1          2.6481     1.9083   1.388    0.238\nI(var1^2)    -0.2235     0.2110  -1.059    0.349\n\nResidual standard error: 2.524 on 4 degrees of freedom\nMultiple R-squared:  0.5099,\tAdjusted R-squared:  0.2648 \nF-statistic: 2.081 on 2 and 4 DF,  p-value: 0.2402\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggpredict(m6, terms = c(\"var1\")) %>% plot()\n```\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-19-1.png){width=60% height=60%}\n:::\n:::\n\n\n## Gewichtetes Regressionsmodell {#gew}\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survey)\npend <- haven::read_dta(\"./orig/PENDDAT_cf_W13.dta\") %>% filter(netges > 0 , palter > 0, azges1 > 0) %>% \n  mutate(zpsex_fct = factor(zpsex, levels = 1:2, labels = c(\"M\",\"W\")))\nwgt_df <- haven::read_dta(\"./orig/pweights_cf_W13.dta\")\npend_wgt <- pend %>% left_join(wgt_df, by = join_by(pnr,welle))\n\n\nmodx <- lm(netges ~ palter + I(palter^2),data=pend)\n\npend_weighted <- svydesign(id      = ~pnr,\n                           weights = ~wqp,\n                           data    = pend_wgt)\n\n# family = gaussian() bekommen wir ein lineares Regressionsmodell, wie bei lm() - mit gewichtet\nsurvey_modx <- svyglm(netges ~ palter + I(palter^2), \n                    family = gaussian(), data = etb18,design = pend_weighted)\n\nmodelsummary(list(\"lm()\"=modx,\"svyglm()\"= survey_modx),gof_omit = \"RM|IC|Log\",output = \"flextable\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-2e99a14a{}.cl-2e90f388{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-2e9460c2{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-2e94733c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2e947346{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2e947347{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2e947350{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-2e99a14a'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-2e94733c\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\"> </span></p></th><th class=\"cl-2e94733c\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">lm()</span></p></th><th class=\"cl-2e94733c\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">svyglm()</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">(Intercept)</span></p></td><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">811.753</span></p></td><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">463.721</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\"></span></p></td><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">(354.363)</span></p></td><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">(504.015)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">palter</span></p></td><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">24.640</span></p></td><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">53.580</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\"></span></p></td><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">(17.071)</span></p></td><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">(26.471)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">I(palter^2)</span></p></td><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">-0.147</span></p></td><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">-0.489</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\"></span></p></td><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">(0.197)</span></p></td><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">(0.314)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2e947347\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">Num.Obs.</span></p></td><td class=\"cl-2e947347\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">7996</span></p></td><td class=\"cl-2e947347\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">7996</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">R2</span></p></td><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">0.004</span></p></td><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">0.007</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">R2 Adj.</span></p></td><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">0.004</span></p></td><td class=\"cl-2e947346\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">-2.252</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2e947350\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">F</span></p></td><td class=\"cl-2e947350\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">15.525</span></p></td><td class=\"cl-2e947350\"><p class=\"cl-2e9460c2\"><span class=\"cl-2e90f388\">8.495</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n## \"Robuste\" Standardfehler {#rbst}\n\n\nHäufig müssen die Standardfehler an Verstöße gegen die allgemeinen Annahmen (Homoskedastizität usw.) angepasst werden.\n\nDie gute Nachricht ist, dass R eine ganze Reihe an Möglichkeiten bietet, Standard-Fehler zu korrigieren.\nUnter anderem mit [{sandwich}](http://sandwich.r-forge.r-project.org/articles/sandwich.html) oder [{estimatr}](https://declaredesign.org/r/estimatr/articles/getting-started.html).\n\nEine sehr einfache Variante ist die Korrektur von Standardfehlern in `{modelsummary}`, die wir uns etwas genauer ansehen:\n\n\nWir können sog. *heteroskedasticity-consistent* (HC) \"robuste\" Standardfehler mit der `vcov`-Option `HC` in `modelsummary()` anfordern. \nDie Hilfe-Seite für `{modelsummary}` bietet eine [Liste mit allen Optionen](https://vincentarelbundock.github.io/modelsummary/articles/modelsummary.html#vcov).\n\nEine Option ist auch `stata`, um Ergebnisse aus Statas `, robust` zu replizieren. \n[Hier mehr](https://declaredesign.org/r/estimatr/articles/stata-wls-hat.html) zu den Hintergründen und Unterschieden.\n\nBasierend auf [den oben eingelesenen Daten](#gew) können wir folgendes Modell schätzen:\n\n::: {.cell}\n\n```{.r .cell-code}\nmod1 <- lm(netges ~ palter + I(palter^2),data=pend) \n\nlibrary(modelsummary)\nmodelsummary(list(mod1,mod1,mod1,mod1),vcov = c(\"classical\",\"HC\",\"HC2\",\"stata\"),gof_omit = \"RM|IC|Log\",output = \"flextable\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-2f8ca962{}.cl-2f836ff0{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-2f86e0d6{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-2f86f422{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2f86f423{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2f86f42c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-2f86f42d{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-2f8ca962'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-2f86f422\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\"> </span></p></th><th class=\"cl-2f86f422\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">(1)</span></p></th><th class=\"cl-2f86f422\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">(2)</span></p></th><th class=\"cl-2f86f422\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">(3)</span></p></th><th class=\"cl-2f86f422\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">(4)</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">(Intercept)</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">811.753</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">811.753</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">811.753</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">811.753</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\"></span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">(354.363)</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">(171.599)</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">(171.543)</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">(171.520)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">palter</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">24.640</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">24.640</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">24.640</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">24.640</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\"></span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">(17.071)</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">(8.923)</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">(8.920)</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">(8.919)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">I(palter^2)</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">-0.147</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">-0.147</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">-0.147</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">-0.147</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\"></span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">(0.197)</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">(0.112)</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">(0.112)</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">(0.112)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2f86f42c\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">Num.Obs.</span></p></td><td class=\"cl-2f86f42c\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">7996</span></p></td><td class=\"cl-2f86f42c\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">7996</span></p></td><td class=\"cl-2f86f42c\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">7996</span></p></td><td class=\"cl-2f86f42c\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">7996</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">R2</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">0.004</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">0.004</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">0.004</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">0.004</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">R2 Adj.</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">0.004</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">0.004</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">0.004</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">0.004</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">F</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">15.525</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">23.449</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">23.441</span></p></td><td class=\"cl-2f86f423\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">23.440</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-2f86f42d\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">Std.Errors</span></p></td><td class=\"cl-2f86f42d\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">IID</span></p></td><td class=\"cl-2f86f42d\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">HC</span></p></td><td class=\"cl-2f86f42d\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">HC2</span></p></td><td class=\"cl-2f86f42d\"><p class=\"cl-2f86e0d6\"><span class=\"cl-2f836ff0\">HC1</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nFür geclusterste SE geben wir `~clustervariable` an;\n\n::: {.cell}\n\n```{.r .cell-code}\nmodelsummary(mod1, vcov = c(\"classical\",~pnr), stars = T,gof_omit = \"RM|IC|Log|F\",output = \"flextable\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-30360afc{}.cl-302d99d0{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-303107be{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-30311b50{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-30311b5a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-30311b64{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-30311b65{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-30311b66{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-30360afc'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-30311b50\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\"> </span></p></th><th class=\"cl-30311b50\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">(1)</span></p></th><th class=\"cl-30311b50\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">(2)</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">(Intercept)</span></p></td><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">811.753*</span></p></td><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">811.753**</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\"></span></p></td><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">(354.363)</span></p></td><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">(274.972)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">palter</span></p></td><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">24.640</span></p></td><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">24.640+</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\"></span></p></td><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">(17.071)</span></p></td><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">(14.475)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">I(palter^2)</span></p></td><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">-0.147</span></p></td><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">-0.147</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\"></span></p></td><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">(0.197)</span></p></td><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">(0.185)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-30311b64\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">Num.Obs.</span></p></td><td class=\"cl-30311b64\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">7996</span></p></td><td class=\"cl-30311b64\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">7996</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">R2</span></p></td><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">0.004</span></p></td><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">0.004</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">R2 Adj.</span></p></td><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">0.004</span></p></td><td class=\"cl-30311b5a\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">0.004</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-30311b65\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">Std.Errors</span></p></td><td class=\"cl-30311b65\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">IID</span></p></td><td class=\"cl-30311b65\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">by: pnr</span></p></td></tr></tbody><tfoot><tr style=\"overflow-wrap:break-word;\"><td  colspan=\"3\"class=\"cl-30311b66\"><p class=\"cl-303107be\"><span class=\"cl-302d99d0\">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</span></p></td></tr></tfoot></table></div>\n```\n:::\n:::\n\n\n## Fixed effects Modelle mit `{fixest}` {#fe}\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"fixest\")\n```\n:::\n\n\n[`{fixest}`](https://lrberge.github.io/fixest)) bietet eine große Auswahl an Möglichkeiten: [logistische FE-Modelle](#10_log_reg.qmd##feglm), mehr-dimensionale Fixed Effects, Multiway clustering, ...\nUnd es ist sehr schnell, [bspw. schneller](https://lrberge.github.io/fixest/#benchmarking) als Statas `reghdfe`. \nFür mehr Details empfiehlt sich die [Vignette](https://lrberge.github.io/fixest/articles/fixest_walkthrough.html).\n\nDie zentrale Funktion zur Schätzung linearer FE-Regressionsmodelle ist `feols()` - sie funktioniert ganz ähnlich zu `lm()`. \nAuch hier geben wir wieder eine Formel nach dem Schema `abhängige Variabe ~ unabhängige Variable(n)` an. \nWir fügen lediglich mit `|` die Variable hinzu, welche die FEs festlegt:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(fixest)\nfe_mod1 <- feols(netges ~ palter + I(palter^2) | pnr, data = pend)\nfe_mod1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOLS estimation, Dep. Var.: netges\nObservations: 7,996 \nFixed-effects: pnr: 2,444\nStandard-errors: Clustered (pnr) \n              Estimate Std. Error  t value   Pr(>|t|)    \npalter      133.811281  14.558248  9.19144  < 2.2e-16 ***\nI(palter^2)  -0.848429   0.154417 -5.49441 4.3261e-08 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nRMSE: 1,222.2     Adj. R2: 0.513287\n                Within R2: 0.009765\n```\n:::\n:::\n\n\n`{fixest}` clustert automatisch die Standardfehler entlang der FE-Variable (hier also `pnr`).\nWenn wir das mal nicht möchten, können wir mit der `se`-Option `= \"standard\"` ungeclusterte SE anfordern:\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(fe_mod1, se = 'standard')\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOLS estimation, Dep. Var.: netges\nObservations: 7,996 \nFixed-effects: pnr: 2,444\nStandard-errors: IID \n              Estimate Std. Error  t value   Pr(>|t|)    \npalter      133.811281  39.896986  3.35392 0.00080209 ***\nI(palter^2)  -0.848429   0.429629 -1.97479 0.04834109 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nRMSE: 1,222.2     Adj. R2: 0.513287\n                Within R2: 0.009765\n```\n:::\n\n```{.r .cell-code}\nsummary(fe_mod1, cluster = ~pnr)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOLS estimation, Dep. Var.: netges\nObservations: 7,996 \nFixed-effects: pnr: 2,444\nStandard-errors: Clustered (pnr) \n              Estimate Std. Error  t value   Pr(>|t|)    \npalter      133.811281  14.558248  9.19144  < 2.2e-16 ***\nI(palter^2)  -0.848429   0.154417 -5.49441 4.3261e-08 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nRMSE: 1,222.2     Adj. R2: 0.513287\n                Within R2: 0.009765\n```\n:::\n:::\n\n\n`{modelsummary}` zeigt die geclusterten SE:\n\n::: {.cell}\n\n```{.r .cell-code}\nmodelsummary(fe_mod1,gof_omit = \"R|IC|Log|F\",stars = T,output = \"flextable\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-31d19ac0{}.cl-31994be8{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-319d27d6{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-319d44c8{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-319d44d2{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-319d44d3{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-319d44dc{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-319d44e6{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-31d19ac0'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-319d44c8\"><p class=\"cl-319d27d6\"><span class=\"cl-31994be8\"> </span></p></th><th class=\"cl-319d44c8\"><p class=\"cl-319d27d6\"><span class=\"cl-31994be8\">(1)</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-319d44d2\"><p class=\"cl-319d27d6\"><span class=\"cl-31994be8\">palter</span></p></td><td class=\"cl-319d44d2\"><p class=\"cl-319d27d6\"><span class=\"cl-31994be8\">133.811***</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-319d44d2\"><p class=\"cl-319d27d6\"><span class=\"cl-31994be8\"></span></p></td><td class=\"cl-319d44d2\"><p class=\"cl-319d27d6\"><span class=\"cl-31994be8\">(14.558)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-319d44d2\"><p class=\"cl-319d27d6\"><span class=\"cl-31994be8\">I(palter^2)</span></p></td><td class=\"cl-319d44d2\"><p class=\"cl-319d27d6\"><span class=\"cl-31994be8\">-0.848***</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-319d44d2\"><p class=\"cl-319d27d6\"><span class=\"cl-31994be8\"></span></p></td><td class=\"cl-319d44d2\"><p class=\"cl-319d27d6\"><span class=\"cl-31994be8\">(0.154)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-319d44d3\"><p class=\"cl-319d27d6\"><span class=\"cl-31994be8\">Num.Obs.</span></p></td><td class=\"cl-319d44d3\"><p class=\"cl-319d27d6\"><span class=\"cl-31994be8\">7996</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-319d44dc\"><p class=\"cl-319d27d6\"><span class=\"cl-31994be8\">Std.Errors</span></p></td><td class=\"cl-319d44dc\"><p class=\"cl-319d27d6\"><span class=\"cl-31994be8\">by: pnr</span></p></td></tr></tbody><tfoot><tr style=\"overflow-wrap:break-word;\"><td  colspan=\"2\"class=\"cl-319d44e6\"><p class=\"cl-319d27d6\"><span class=\"cl-31994be8\">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</span></p></td></tr></tfoot></table></div>\n```\n:::\n:::\n\n\n## Mehrebenenmodelle mit `{lme4}` {#mlvl}\n\n\nMit `lmer()` können wir ein Random Intercept Modell berechnen, indem wir mit `( 1 | pnr)` angeben, dass für `pnr` jeweils ein eigenes Random Intercept berechnet werden soll:\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lme4)\nml_m3 <- lmer(netges ~ palter + I(palter^2) + ( 1 | pnr), data=pend)\n\nmodelsummary(list(ml_m3),gof_omit = \"R|IC|Log|F\",output = \"flextable\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-32f4be0a{}.cl-32ebb774{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-32ef648c{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-32ef7be8{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-32ef7bf2{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-32ef7bf3{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-32f4be0a'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-32ef7be8\"><p class=\"cl-32ef648c\"><span class=\"cl-32ebb774\"> </span></p></th><th class=\"cl-32ef7be8\"><p class=\"cl-32ef648c\"><span class=\"cl-32ebb774\">(1)</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-32ef7bf2\"><p class=\"cl-32ef648c\"><span class=\"cl-32ebb774\">(Intercept)</span></p></td><td class=\"cl-32ef7bf2\"><p class=\"cl-32ef648c\"><span class=\"cl-32ebb774\">754.388</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-32ef7bf2\"><p class=\"cl-32ef648c\"><span class=\"cl-32ebb774\"></span></p></td><td class=\"cl-32ef7bf2\"><p class=\"cl-32ef648c\"><span class=\"cl-32ebb774\">(392.459)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-32ef7bf2\"><p class=\"cl-32ef648c\"><span class=\"cl-32ebb774\">palter</span></p></td><td class=\"cl-32ef7bf2\"><p class=\"cl-32ef648c\"><span class=\"cl-32ebb774\">18.523</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-32ef7bf2\"><p class=\"cl-32ef648c\"><span class=\"cl-32ebb774\"></span></p></td><td class=\"cl-32ef7bf2\"><p class=\"cl-32ef648c\"><span class=\"cl-32ebb774\">(19.083)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-32ef7bf2\"><p class=\"cl-32ef648c\"><span class=\"cl-32ebb774\">I(palter^2)</span></p></td><td class=\"cl-32ef7bf2\"><p class=\"cl-32ef648c\"><span class=\"cl-32ebb774\">-0.020</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-32ef7bf2\"><p class=\"cl-32ef648c\"><span class=\"cl-32ebb774\"></span></p></td><td class=\"cl-32ef7bf2\"><p class=\"cl-32ef648c\"><span class=\"cl-32ebb774\">(0.222)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-32ef7bf2\"><p class=\"cl-32ef648c\"><span class=\"cl-32ebb774\">SD (Intercept pnr)</span></p></td><td class=\"cl-32ef7bf2\"><p class=\"cl-32ef648c\"><span class=\"cl-32ebb774\">1327.674</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-32ef7bf2\"><p class=\"cl-32ef648c\"><span class=\"cl-32ebb774\">SD (Observations)</span></p></td><td class=\"cl-32ef7bf2\"><p class=\"cl-32ef648c\"><span class=\"cl-32ebb774\">1414.455</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-32ef7bf3\"><p class=\"cl-32ef648c\"><span class=\"cl-32ebb774\">Num.Obs.</span></p></td><td class=\"cl-32ef7bf3\"><p class=\"cl-32ef648c\"><span class=\"cl-32ebb774\">7996</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nMehr zu Mehrebenenmodellen und `{lme4}` in Blogposts von [Rense Nieuwenhuis ](http://www.rensenieuwenhuis.nl/r-sessions-16-multilevel-model-specification-lme4/) und [Tristan Mahr](https://www.tjmahr.com/plotting-partial-pooling-in-mixed-effects-models/).\n\n\n<!-- ## Abschließende Bemerkungen -->\n\n<!-- Zusammengefasst lassen uns `{fixest}` und `{modelsummary}` Standardfehler nach der eigentlichen Modellschätzung anpassen, indem wir die  `se` or `cluster` Optionen verwenden.  -->\n\n<!-- Ein [Blog Post von Grant Mcdermott](https://grantmcdermott.com/better-way-adjust-SEs/) argumentiert noch etwas ausführlicher, warum die nachträgliche Berechnung der Standardfehler (anstelle einer kompletten Neuschätzung des Modells) eine gute Idee ist - auch wenn es für Stata-Nutzende ein sehr ungewöhnliches Vorgehen ist. -->\n\n<!-- Die exakte Replikation von Standardfehlern aus anderen Programmen (bspw, Stata) ist oft schwieriger als es zunächst scheint.  -->\n<!-- Siehe auch die Diskussion [hier](https://github.com/sgaure/lfe/issues/1#issuecomment-530643808)  -->\n<!-- [Detaillierte vignette](https://lrberge.github.io/fixest/articles/standard_errors.html) `{fixest}` wie SEs aus anderen Programmen repliziert werden können. -->\n<!-- [Detailliertes Paper](http://sandwich.r-forge.r-project.org/articles/jss_2020.html) von den Autoren von `{sandwich}` zu diesem Thema.  -->\n\n## Anhang: Predictions mit `marginaleffects` und \"manuelle\" Darstellung\n\nWir hatten im Kapitel [Interaktionen](#interaktionen) folgendes Modell geschätzt:\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(m5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = var2 ~ var1 * g_fct, data = dat1)\n\nResiduals:\n      1       2       3       4       5       6       7       8 \n-1.5000  2.6145 -0.8827  4.5000 -7.3687 -1.5000  5.6369 -1.5000 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)  \n(Intercept)    -3.1117     4.7702  -0.652   0.5498  \nvar1            2.4972     0.8211   3.041   0.0384 *\ng_fctmen        5.9451     8.4973   0.700   0.5227  \nvar1:g_fctmen  -2.1639     1.5331  -1.411   0.2310  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 5.493 on 4 degrees of freedom\nMultiple R-squared:  0.7244,\tAdjusted R-squared:  0.5177 \nF-statistic: 3.504 on 3 and 4 DF,  p-value: 0.1286\n```\n:::\n:::\n\n\nMit `predictions()` aus `{marginaleffects}` können wir basierend auf unserem Modell vorhergesagte Werte für bestimmte Werte berechnen.\nDazu geben wir die die gewünschten mit einem `expand.grid()` an.\n\n::: {.cell}\n\n```{.r .cell-code}\n# Kombinationen aller Werte erstellen\nexpand.grid(var1 = 1:5, \n            g_fct =  c(\"women\",\"men\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   var1 g_fct\n1     1 women\n2     2 women\n3     3 women\n4     4 women\n5     5 women\n6     1   men\n7     2   men\n8     3   men\n9     4   men\n10    5   men\n```\n:::\n:::\n\n\nDiese Werte geben wir dann in `predictions()` als `newdata =` an:\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(marginaleffects)\np <- predictions(m5, \n                 newdata = expand.grid(var1 = 1:5,\n                                       g_fct =  c(\"women\",\"men\")) )\n                 \nhead(data.frame(p))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  rowid   estimate std.error  statistic      p.value  conf.low conf.high var1\n1     1 -0.6145251  4.126052 -0.1489378 0.8816027065 -8.701438  7.472388    1\n2     2  1.8826816  3.555532  0.5295076 0.5964533448 -5.086034  8.851397    2\n3     3  4.3798883  3.099641  1.4130307 0.1576466975 -1.695297 10.455074    3\n4     4  6.8770950  2.814641  2.4433298 0.0145524331  1.360501 12.393689    4\n5     5  9.3743017  2.754104  3.4037579 0.0006646564  3.976358 14.772245    5\n6     6  3.1666667  5.861938  0.5402082 0.5890534765 -8.322520 14.655853    1\n  g_fct var2\n1 women    2\n2 women    2\n3 women    2\n4 women    2\n5 women    2\n6   men    2\n```\n:::\n:::\n\n\nFür den `ggplot()` verwenden wir dann `geom_line()` zusammen mit \n\n+ `geom_errorbar()` für eine Darstellung mit Konfidenzintervallen als Error Bars \n+ mit `geom_ribbon()` erhalten wir die Konfidenzintervalle als Konfidenzbänder (hier müssen wir mit `alpha = ` die Deckkraft der etwas heruntersetzen und die Farbe mit `fill=` angeben um den Bereich einzufärben). \n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\npred_plt <- \n    ggplot(data= data.frame(p),\n           aes(x = var1, \n               y =  estimate, \n               ymin = conf.low,ymax = conf.high,\n               color = g_fct)) + \n      geom_line() + \n      scale_color_manual(values = c(\"orange\",\"lightskyblue3\"),breaks = c(\"women\",\"men\"),labels=c(\"Frauen\",\"Männer\")) +\n      labs(title = \"Vorhergesagte Werte für var2\",\n           color = \"Gender\",\n           x = \"Werte für var1\",\n           y = \"Vorhergesagte Werte für var1\") +\n      theme_minimal()\n\n# Konfidenzintervalle\npred_plt + \n  geom_point(size = 2.75) +\n  geom_errorbar(width = .1)\n```\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-29-1.png){width=3500}\n:::\n\n```{.r .cell-code}\n# mit Konfidenzbändern\npred_plt + \n  geom_ribbon(alpha = .1, color = NA,aes(fill = g_fct)) +\n  scale_fill_manual(values = c(\"orange\",\"lightskyblue3\"),breaks = c(\"women\",\"men\"),labels=c(\"Frauen\",\"Männer\")) +\n  labs(fill = \"Gender\")\n```\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-29-2.png){width=3500}\n:::\n:::\n",
    "supporting": [
      "09_reg2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/tabwid-1.1.3/tabwid.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/tabwid-1.1.3/tabwid.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}