{
  "hash": "eab84d60e835ae9acb4ab8095fcf790f",
  "result": {
    "markdown": "# Regressionsmodelle: Erweiterungen\n\n\n\n\n\nNach den basics für Regressionsmodelle sehen wir uns in diesem Kapitel einige hilfreiche Erweiterungen von Regressionsmodellen in R an.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\ndat1 <- data.frame(id   = 1:8,\n                   var1 = c(2,1,2,5,7, 8, 9,5),\n                   var2 = c(2,2,1,9,7, 4,25,3),\n                   educ = c(3,1,2,2,1, 3, 2,-1),\n                   gend = c(2,1,1,2,1,2,1,2),\n                   x    = c(2,1,2,4,1,NA,NA,NA) )\ndat1$ed_fct <- factor(dat1$educ, levels = 1:3,\n                        labels = c(\"basic\",\"medium\",\"high\"))\ndat1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  id var1 var2 educ gend  x ed_fct\n1  1    2    2    3    2  2   high\n2  2    1    2    1    1  1  basic\n3  3    2    1    2    1  2 medium\n4  4    5    9    2    2  4 medium\n5  5    7    7    1    1  1  basic\n6  6    8    4    3    2 NA   high\n7  7    9   25    2    1 NA medium\n8  8    5    3   -1    2 NA   <NA>\n```\n:::\n:::\n\n\n\n+ [vollständige Zeilen mit `complete.cases()`](#complcses) -> `e(sample)` in Stata\n+ [Interaktionen](#inter) -> `c.var1##c.var2` in Stata\n+ [Quadratische Terme](#quad) -> `c.var1##c.var1` in Stata\n+ [Gewichte anwenden](#gew) \n+ [Robuste Standardfehler](#rbst)\n+ [Fixed Effects Modelle](#fe)\n+ [Mehrebenenmodelle](#mlvl)\n\n## Nur vollständige Zeilen behalten {#complcses}\n\nWenn wir die beiden Modelle `m1` und `m3` vergleichen, sehen wir unterschiedliche Fallzahlen:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1 <- lm(var2~ var1, data = dat1)  \nm4 <- lm(var2 ~ ed_fct  + var1, dat1)\nmodelsummary(list(\"m1\"=m1,\"m4\"=m4),gof_omit = \"IC|RM|Log|F\",output = \"flextable\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-a702dab0{}.cl-a6f97e8e{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-a6fd406e{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a6fd5afe{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a6fd5b08{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a6fd5b12{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a6fd5b13{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-a702dab0'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-a6fd5afe\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\"> </span></p></th><th class=\"cl-a6fd5afe\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">m1</span></p></th><th class=\"cl-a6fd5afe\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">m4</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">(Intercept)</span></p></td><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">-2.340</span></p></td><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">-2.511</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\"></span></p></td><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">(4.345)</span></p></td><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">(5.681)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">var1</span></p></td><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">1.839</span></p></td><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">1.753</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\"></span></p></td><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">(0.773)</span></p></td><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">(0.835)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">ed_fctmedium</span></p></td><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\"></span></p></td><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">4.830</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\"></span></p></td><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\"></span></p></td><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">(6.038)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">ed_fcthigh</span></p></td><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\"></span></p></td><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">-3.253</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\"></span></p></td><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\"></span></p></td><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">(6.554)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a6fd5b12\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">Num.Obs.</span></p></td><td class=\"cl-a6fd5b12\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">8</span></p></td><td class=\"cl-a6fd5b12\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">7</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">R2</span></p></td><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">0.486</span></p></td><td class=\"cl-a6fd5b08\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">0.700</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a6fd5b13\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">R2 Adj.</span></p></td><td class=\"cl-a6fd5b13\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">0.400</span></p></td><td class=\"cl-a6fd5b13\"><p class=\"cl-a6fd406e\"><span class=\"cl-a6f97e8e\">0.400</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n\nEs zeigt sich, dass in Modell `m4` mit `edu_fct` 1 Fall verloren geht. Woran liegt das?\nDazu lohnt sich ein Blick in die Daten:\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  id var1 var2 educ gend  x ed_fct\n1  1    2    2    3    2  2   high\n2  2    1    2    1    1  1  basic\n3  3    2    1    2    1  2 medium\n4  4    5    9    2    2  4 medium\n5  5    7    7    1    1  1  basic\n6  6    8    4    3    2 NA   high\n7  7    9   25    2    1 NA medium\n8  8    5    3   -1    2 NA   <NA>\n```\n:::\n:::\n\n\nDie Angabe für `ed_fct` fehlt in für `id` = 8.\n\nUm die Modelle zu vergleichen sollten wir also nur die Zeilen verwenden, für die auch die Werte für `ed_fct` vorliegen.\nHier können wir diese Zeilen per Hand auswählen (und `id`=8 ausschließen), in größeren Datensätzen ist das aber mühsam.\n\n### `complete.cases()`\n\nHier hilft uns `complete.cases()`.\nDiese Funktion erstellt eine logische Variable, welche ein `TRUE` für alle vollständigen Fälle (also ohne ein `NA`). \nUnvollständige Fälle werden mit einem `FALSE` versehen. \nDazu geben wir an, welche Variablen jeweils für diese Betrachtung berücksichtigt werden sollen und legen die Variable einfach im Datensatz als neue Spalte an. \nFür Modell 1 ist ein Fall `complete`, wenn `var2` und `var1` vorliegen. \nWir wählen also mit `select()` die relevanten Variablen aus und wenden `complete.cases` auf diese Auswahl an:\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1 %>% select(var1,var2) %>% complete.cases(.) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE\n```\n:::\n\n```{.r .cell-code}\ndat1$compl_m1 <- dat1 %>% select(var1,var2) %>% complete.cases(.) \ndat1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  id var1 var2 educ gend  x ed_fct compl_m1\n1  1    2    2    3    2  2   high     TRUE\n2  2    1    2    1    1  1  basic     TRUE\n3  3    2    1    2    1  2 medium     TRUE\n4  4    5    9    2    2  4 medium     TRUE\n5  5    7    7    1    1  1  basic     TRUE\n6  6    8    4    3    2 NA   high     TRUE\n7  7    9   25    2    1 NA medium     TRUE\n8  8    5    3   -1    2 NA   <NA>     TRUE\n```\n:::\n:::\n\n::: {.callout-warning collapse=\"true\"}\n# `complete.cases()` alleine sucht in allen Variablen nach `NA`\nAchtung: wenn wir keine Variablen angeben, werden `NA` aus allen Variablen berücksichtigt, hier also auch die `NA` aus `x` - die uns hier nicht interessieren:\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1 %>% complete.cases(.) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE\n```\n:::\n\n```{.r .cell-code}\ndat1$compl <- dat1 %>% complete.cases(.) \ndat1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  id var1 var2 educ gend  x ed_fct compl_m1 compl\n1  1    2    2    3    2  2   high     TRUE  TRUE\n2  2    1    2    1    1  1  basic     TRUE  TRUE\n3  3    2    1    2    1  2 medium     TRUE  TRUE\n4  4    5    9    2    2  4 medium     TRUE  TRUE\n5  5    7    7    1    1  1  basic     TRUE  TRUE\n6  6    8    4    3    2 NA   high     TRUE FALSE\n7  7    9   25    2    1 NA medium     TRUE FALSE\n8  8    5    3   -1    2 NA   <NA>     TRUE FALSE\n```\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\n:::\n\n...das gleiche machen wir für Modell `m4`, welches neben `var2` und `var1` ja auch noch `ed_fct` enthält:\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1$compl_m4 <- dat1 %>% select(var1,var2,ed_fct) %>% complete.cases(.)\n```\n:::\n\n\nSo sieht das dann im Datensatz aus:\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  id var1 var2 educ gend  x ed_fct compl_m1 compl_m4\n1  1    2    2    3    2  2   high     TRUE     TRUE\n2  2    1    2    1    1  1  basic     TRUE     TRUE\n3  3    2    1    2    1  2 medium     TRUE     TRUE\n4  4    5    9    2    2  4 medium     TRUE     TRUE\n5  5    7    7    1    1  1  basic     TRUE     TRUE\n6  6    8    4    3    2 NA   high     TRUE     TRUE\n7  7    9   25    2    1 NA medium     TRUE     TRUE\n8  8    5    3   -1    2 NA   <NA>     TRUE    FALSE\n```\n:::\n:::\n\n\n\n\n\n### Fälle mit missings finden\nJetzt können wir nach diesen Variablen filtern und uns diese Fälle genauer ansehen. Dazu filtern wir nach den Fällen, die zwar in `m1` enthalten (also `compl_m1` = `TRUE`) sind, aber nicht in `m4` (`compl_m4` = `FALSE`):\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1 %>% filter(compl_m1 == T & compl_m4 == F) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  id var1 var2 educ gend  x ed_fct compl_m1 compl_m4\n1  8    5    3   -1    2 NA   <NA>     TRUE    FALSE\n```\n:::\n:::\n\n\n### Modelle nur mit vollständigen Fällen berechnen\nAußerdem können wir jetzt auch das Modell `m1` so erstellen, dass wir nur die Fälle miteinbeziehen, die auch in Modell2 berücksichtigt werden:\n\n::: {.cell}\n\n```{.r .cell-code}\nm1_m4vars <- lm(var2 ~ var1     , data = filter(dat1,compl_m4 == T))\nmodelsummary(list(\"m1\"=m1,\"m1 mit m4vars\"=m1_m4vars,\"m4\"=m4),gof_omit = \"IC|RM|Log|F\",output = \"flextable\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-a9b3d458{}.cl-a9ab257e{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-a9ae3ae8{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a9ae4d76{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a9ae4d77{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a9ae4d80{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a9ae4d81{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-a9b3d458'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-a9ae4d76\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\"> </span></p></th><th class=\"cl-a9ae4d76\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">m1</span></p></th><th class=\"cl-a9ae4d76\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">m1 mit m4vars</span></p></th><th class=\"cl-a9ae4d76\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">m4</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">(Intercept)</span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">-2.340</span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">-1.832</span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">-2.511</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\"></span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">(4.345)</span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">(4.646)</span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">(5.681)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">var1</span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">1.839</span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">1.848</span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">1.753</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\"></span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">(0.773)</span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">(0.814)</span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">(0.835)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">ed_fctmedium</span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\"></span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\"></span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">4.830</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\"></span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\"></span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\"></span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">(6.038)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">ed_fcthigh</span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\"></span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\"></span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">-3.253</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\"></span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\"></span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\"></span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">(6.554)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a9ae4d80\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">Num.Obs.</span></p></td><td class=\"cl-a9ae4d80\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">8</span></p></td><td class=\"cl-a9ae4d80\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">7</span></p></td><td class=\"cl-a9ae4d80\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">7</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">R2</span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">0.486</span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">0.508</span></p></td><td class=\"cl-a9ae4d77\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">0.700</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a9ae4d81\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">R2 Adj.</span></p></td><td class=\"cl-a9ae4d81\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">0.400</span></p></td><td class=\"cl-a9ae4d81\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">0.409</span></p></td><td class=\"cl-a9ae4d81\"><p class=\"cl-a9ae3ae8\"><span class=\"cl-a9ab257e\">0.400</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nJetzt haben wir also in `m1 mit m4vars` und `m4` die gleiche Fallzahl und können so die Ergebnisse direkt miteinander vergleichen.\n\n## Interaktionen {#inter}\n\nInteraktionen zwischen zwei Variablen können wir mit `*` berechnen:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1$g_fct <- factor(dat1$gend,levels = 1:2,\n                     labels = c(\"women\",\"men\"))\nm5 <- lm(var2 ~ var1 * g_fct, dat1)\nsummary(m5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = var2 ~ var1 * g_fct, data = dat1)\n\nResiduals:\n      1       2       3       4       5       6       7       8 \n-1.5000  2.6145 -0.8827  4.5000 -7.3687 -1.5000  5.6369 -1.5000 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)  \n(Intercept)    -3.1117     4.7702  -0.652   0.5498  \nvar1            2.4972     0.8211   3.041   0.0384 *\ng_fctmen        5.9451     8.4973   0.700   0.5227  \nvar1:g_fctmen  -2.1639     1.5331  -1.411   0.2310  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 5.493 on 4 degrees of freedom\nMultiple R-squared:  0.7244,\tAdjusted R-squared:  0.5177 \nF-statistic: 3.504 on 3 and 4 DF,  p-value: 0.1286\n```\n:::\n:::\n\n\nInteraktionen sollten immer visualisiert werden.\nDafür ist [`{ggeffects}`](https://strengejacke.github.io/ggeffects/index.html) eine große Hilfe:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"ggeffects\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggeffects)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Paket 'ggeffects' wurde unter R Version 4.2.3 erstellt\n```\n:::\n\n```{.r .cell-code}\nggpredict(m5, terms = c(\"var1\",\"g_fct[women,men]\")) %>% plot()\n```\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-15-1.png){width=80% height=60%}\n:::\n\n```{.r .cell-code}\n# oder nebeneinander:\nggpredict(m5, terms = c(\"var1\",\"g_fct[women,men]\")) %>% plot(facet=TRUE)\n```\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-15-2.png){width=80% height=60%}\n:::\n:::\n\n\nWir können diese Darstellung mit den bekannten `{ggplot2}`-Befehlen verändern:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggpredict(m5, terms = c(\"var1\",\"g_fct[women,men]\")) %>% plot() + \n  scale_color_manual(values = c(\"orange\",\"lightskyblue3\"),breaks = c(\"women\",\"men\"),labels=c(\"Frauen\",\"Männer\")) +\n  scale_fill_manual(values = c(\"orange\",\"lightskyblue3\"),breaks = c(\"women\",\"men\"),labels=c(\"Frauen\",\"Männer\")) +\n  labs(title = \"Vorhergesagte Werte für var2\",\n       color = \"Gender\",\n       x = \"Werte für var1\",\n       y = \"Vorhergesagte Werte für var1\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nScale for colour is already present.\nAdding another scale for colour, which will replace the existing scale.\n```\n:::\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-16-1.png){width=60% height=60%}\n:::\n:::\n\n\n## Quadratische Terme & Polynome {#quad}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm6 <- lm(var2 ~ var1 + I(var1^2), dat1 %>% filter(id != 7))\nsummary(m6)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = var2 ~ var1 + I(var1^2), data = dat1 %>% filter(id != \n    7))\n\nResiduals:\n      1       2       3       4       5       6       7 \n-0.5443  1.4334 -1.5443  3.2043  1.2713 -1.0248 -2.7957 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)\n(Intercept)  -1.8580     3.4066  -0.545    0.614\nvar1          2.6481     1.9083   1.388    0.238\nI(var1^2)    -0.2235     0.2110  -1.059    0.349\n\nResidual standard error: 2.524 on 4 degrees of freedom\nMultiple R-squared:  0.5099,\tAdjusted R-squared:  0.2648 \nF-statistic: 2.081 on 2 and 4 DF,  p-value: 0.2402\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggpredict(m6, terms = c(\"var1\")) %>% plot()\n```\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-19-1.png){width=60% height=60%}\n:::\n:::\n\n\n## Gewichtetes Regressionsmodell {#gew}\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survey)\npend <- haven::read_dta(\"./orig/PENDDAT_cf_W13.dta\") %>% filter(netges > 0 , palter > 0)\nwgt_df <- haven::read_dta(\"./orig/pweights_cf_W13.dta\")\nhead(wgt_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 7\n         pnr welle                   sample             wqp ppbleib   psu strpsu\n       <dbl> <dbl+lbl>               <dbl+lbl>        <dbl>   <dbl> <dbl>  <dbl>\n1 1000001901 1 [Welle 1 (2006/2007)] 2 [Microm-Stic… 20075.   NA       80     64\n2 1000001901 3 [Welle 3 (2008/2009)] 2 [Microm-Stic… 32959.   NA       80     64\n3 1000001902 1 [Welle 1 (2006/2007)] 2 [Microm-Stic… 23077.   NA       80     64\n4 1000002001 1 [Welle 1 (2006/2007)] 1 [BA-Stichpro…  1639.    1.87    80     64\n5 1000002001 2 [Welle 2 (2007/2008)] 1 [BA-Stichpro…  1668.    1.12    80     64\n6 1000002001 3 [Welle 3 (2008/2009)] 1 [BA-Stichpro…  1748.    1.36    80     64\n```\n:::\n\n```{.r .cell-code}\npend_wgt <- pend %>% left_join(wgt_df, by = join_by(pnr,welle))\n\n\nmodx <- lm(netges ~ palter + I(palter^2),data=pend)\n\npend_weighted <- svydesign(id      = ~pnr,\n                           weights = ~wqp,\n                           data    = pend_wgt)\n\n# family = gaussian() bekommen wir ein lineares Regressionsmodell, wie bei lm() - mit gewichtet\nsurvey_modx <- svyglm(netges ~ palter + I(palter^2), \n                    family = gaussian(), data = etb18,design = pend_weighted)\n\nmodelsummary(list(\"lm()\"=modx,\"svyglm()\"= survey_modx),gof_omit = \"RM|IC|Log\",output = \"flextable\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-b31d63e2{}.cl-b31559fe{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-b3187094{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-b31882a0{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b31882a1{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b31882aa{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b31882ab{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-b31d63e2'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-b31882a0\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\"> </span></p></th><th class=\"cl-b31882a0\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">lm()</span></p></th><th class=\"cl-b31882a0\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">svyglm()</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">(Intercept)</span></p></td><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">328.208</span></p></td><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">301.791</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\"></span></p></td><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">(282.965)</span></p></td><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">(658.783)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">palter</span></p></td><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">49.587</span></p></td><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">58.344</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\"></span></p></td><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">(13.355)</span></p></td><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">(33.862)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">I(palter^2)</span></p></td><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">-0.448</span></p></td><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">-0.510</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\"></span></p></td><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">(0.152)</span></p></td><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">(0.402)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b31882aa\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">Num.Obs.</span></p></td><td class=\"cl-b31882aa\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">10202</span></p></td><td class=\"cl-b31882aa\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">10202</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">R2</span></p></td><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">0.004</span></p></td><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">0.011</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">R2 Adj.</span></p></td><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">0.003</span></p></td><td class=\"cl-b31882a1\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">-2.170</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b31882ab\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">F</span></p></td><td class=\"cl-b31882ab\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">18.573</span></p></td><td class=\"cl-b31882ab\"><p class=\"cl-b3187094\"><span class=\"cl-b31559fe\">13.924</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n## \"Robuste\" Standardfehler {#rbst}\n\n\nHäufig müssen die Standardfehler an Verstöße gegen die allgemeinen Annahmen (Homoskedastizität usw.) angepasst werden.\n\nDie gute Nachricht ist, dass R eine ganze Reihe an Möglichkeiten bietet, Standard-Fehler zu korrigieren.\nUnter anderem mit [{sandwich}](http://sandwich.r-forge.r-project.org/articles/sandwich.html) oder [{estimatr}](https://declaredesign.org/r/estimatr/articles/getting-started.html).\n\nEine sehr einfache Variante ist die Korrektur von Standardfehlern in `{modelsummary}`, die wir uns etwas genauer ansehen:\n\n\nWir können sog. *heteroskedasticity-consistent* (HC) \"robuste\" Standardfehler mit der `vcov`-Option `HC` in `modelsummary()` anfordern. \nDie Hilfe-Seite für `{modelsummary}` bietet eine [Liste mit allen Optionen](https://vincentarelbundock.github.io/modelsummary/articles/modelsummary.html#vcov).\n\nEine Option ist auch `stata`, um Ergebnisse aus Statas `, robust` zu replizieren. \n[Hier mehr](https://declaredesign.org/r/estimatr/articles/stata-wls-hat.html) zu den Hintergründen und Unterschieden.\n\nBasierend auf [den oben eingelesenen Daten](#gew) können wir folgendes Modell schätzen:\n\n::: {.cell}\n\n```{.r .cell-code}\nmod1 <- lm(netges ~ palter + I(palter^2),data=pend) \n\nlibrary(modelsummary)\nmodelsummary(list(mod1,mod1,mod1,mod1),vcov = c(\"classical\",\"HC\",\"HC2\",\"stata\"),gof_omit = \"RM|IC|Log\",output = \"flextable\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-b400b192{}.cl-b3f87c8e{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-b3fbb156{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-b3fbc678{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b3fbc682{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b3fbc683{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b3fbc68c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-b400b192'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-b3fbc678\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\"> </span></p></th><th class=\"cl-b3fbc678\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">(1)</span></p></th><th class=\"cl-b3fbc678\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">(2)</span></p></th><th class=\"cl-b3fbc678\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">(3)</span></p></th><th class=\"cl-b3fbc678\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">(4)</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">(Intercept)</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">328.208</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">328.208</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">328.208</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">328.208</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\"></span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">(282.965)</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">(313.224)</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">(313.040)</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">(312.903)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">palter</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">49.587</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">49.587</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">49.587</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">49.587</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\"></span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">(13.355)</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">(13.504)</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">(13.494)</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">(13.486)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">I(palter^2)</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">-0.448</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">-0.448</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">-0.448</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">-0.448</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\"></span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">(0.152)</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">(0.142)</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">(0.142)</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">(0.142)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b3fbc683\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">Num.Obs.</span></p></td><td class=\"cl-b3fbc683\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">10202</span></p></td><td class=\"cl-b3fbc683\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">10202</span></p></td><td class=\"cl-b3fbc683\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">10202</span></p></td><td class=\"cl-b3fbc683\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">10202</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">R2</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">0.004</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">0.004</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">0.004</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">0.004</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">R2 Adj.</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">0.003</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">0.003</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">0.003</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">0.003</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">F</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">18.573</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">11.517</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">11.512</span></p></td><td class=\"cl-b3fbc682\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">11.514</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b3fbc68c\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">Std.Errors</span></p></td><td class=\"cl-b3fbc68c\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">IID</span></p></td><td class=\"cl-b3fbc68c\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">HC</span></p></td><td class=\"cl-b3fbc68c\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">HC2</span></p></td><td class=\"cl-b3fbc68c\"><p class=\"cl-b3fbb156\"><span class=\"cl-b3f87c8e\">HC1</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nFür geclusterste SE geben wir `~clustervariable` an;\n\n::: {.cell}\n\n```{.r .cell-code}\nmodelsummary(mod1, vcov = c(\"classical\",~pnr), stars = T,gof_omit = \"RM|IC|Log|F\",output = \"flextable\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-b495cfca{}.cl-b48de706{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-b490f806{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-b4910b48{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b4910b49{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b4910b52{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b4910b53{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b4910b54{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-b495cfca'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-b4910b48\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\"> </span></p></th><th class=\"cl-b4910b48\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">(1)</span></p></th><th class=\"cl-b4910b48\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">(2)</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">(Intercept)</span></p></td><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">328.208</span></p></td><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">328.208</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\"></span></p></td><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">(282.965)</span></p></td><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">(382.332)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">palter</span></p></td><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">49.587***</span></p></td><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">49.587**</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\"></span></p></td><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">(13.355)</span></p></td><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">(17.343)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">I(palter^2)</span></p></td><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">-0.448**</span></p></td><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">-0.448*</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\"></span></p></td><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">(0.152)</span></p></td><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">(0.189)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b4910b52\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">Num.Obs.</span></p></td><td class=\"cl-b4910b52\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">10202</span></p></td><td class=\"cl-b4910b52\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">10202</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">R2</span></p></td><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">0.004</span></p></td><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">0.004</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">R2 Adj.</span></p></td><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">0.003</span></p></td><td class=\"cl-b4910b49\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">0.003</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b4910b53\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">Std.Errors</span></p></td><td class=\"cl-b4910b53\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">IID</span></p></td><td class=\"cl-b4910b53\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">by: pnr</span></p></td></tr></tbody><tfoot><tr style=\"overflow-wrap:break-word;\"><td  colspan=\"3\"class=\"cl-b4910b54\"><p class=\"cl-b490f806\"><span class=\"cl-b48de706\">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</span></p></td></tr></tfoot></table></div>\n```\n:::\n:::\n\n\n## Fixed effects Modelle mit `{fixest}` {#fe}\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"fixest\")\n```\n:::\n\n\n[`{fixest}`](https://lrberge.github.io/fixest)) bietet eine große Auswahl an Möglichkeiten: [logistische FE-Modelle](#10_log_reg.qmd##feglm), mehr-dimensionale Fixed Effects, Multiway clustering, ...\nUnd es ist sehr schnell, [bspw. schneller](https://lrberge.github.io/fixest/#benchmarking) als Statas `reghdfe`. \nFür mehr Details empfiehlt sich die [Vignette](https://lrberge.github.io/fixest/articles/fixest_walkthrough.html).\n\nDie zentrale Funktion zur Schätzung linearer FE-Regressionsmodelle ist `feols()` - sie funktioniert ganz ähnlich zu `lm()`. \nAuch hier geben wir wieder eine Formel nach dem Schema `abhängige Variabe ~ unabhängige Variable(n)` an. \nWir fügen lediglich mit `|` die Variable hinzu, welche die FEs festlegt:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(fixest)\nfe_mod1 <- feols(netges ~ palter + I(palter^2) | pnr, data = pend)\nfe_mod1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOLS estimation, Dep. Var.: netges\nObservations: 10,202 \nFixed-effects: pnr: 3,186\nStandard-errors: Clustered (pnr) \n             Estimate Std. Error  t value   Pr(>|t|)    \npalter      157.75306  24.236868  6.50881 8.7674e-11 ***\nI(palter^2)  -1.01412   0.359875 -2.81797 4.8627e-03 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nRMSE: 1,288.1     Adj. R2: 0.530174\n                Within R2: 0.013165\n```\n:::\n:::\n\n\n`{fixest}` clustert automatisch die Standardfehler entlang der FE-Variable (hier also `pnr`).\nWenn wir das mal nicuth möchten, können wir mit der `se`-Option `= \"standard\"` ungeclusterte SE anfordern:\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(fe_mod1, se = 'standard')\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOLS estimation, Dep. Var.: netges\nObservations: 10,202 \nFixed-effects: pnr: 3,186\nStandard-errors: IID \n             Estimate Std. Error  t value   Pr(>|t|)    \npalter      157.75306  33.634861  4.69017 2.7815e-06 ***\nI(palter^2)  -1.01412   0.358183 -2.83128 4.6494e-03 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nRMSE: 1,288.1     Adj. R2: 0.530174\n                Within R2: 0.013165\n```\n:::\n\n```{.r .cell-code}\nsummary(fe_mod1, cluster = ~pnr)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOLS estimation, Dep. Var.: netges\nObservations: 10,202 \nFixed-effects: pnr: 3,186\nStandard-errors: Clustered (pnr) \n             Estimate Std. Error  t value   Pr(>|t|)    \npalter      157.75306  24.236868  6.50881 8.7674e-11 ***\nI(palter^2)  -1.01412   0.359875 -2.81797 4.8627e-03 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nRMSE: 1,288.1     Adj. R2: 0.530174\n                Within R2: 0.013165\n```\n:::\n:::\n\n\n`{modelsummary}` zeigt die geclusterten SE:\n\n::: {.cell}\n\n```{.r .cell-code}\nmodelsummary(list(fe_mod1),gof_omit = \"R|IC|Log|F\",output = \"flextable\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-b5ef4310{}.cl-b5e73cce{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-b5eaa378{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-b5eab570{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b5eab571{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b5eab572{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b5eab57a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-b5ef4310'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-b5eab570\"><p class=\"cl-b5eaa378\"><span class=\"cl-b5e73cce\"> </span></p></th><th class=\"cl-b5eab570\"><p class=\"cl-b5eaa378\"><span class=\"cl-b5e73cce\">(1)</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b5eab571\"><p class=\"cl-b5eaa378\"><span class=\"cl-b5e73cce\">palter</span></p></td><td class=\"cl-b5eab571\"><p class=\"cl-b5eaa378\"><span class=\"cl-b5e73cce\">157.753</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b5eab571\"><p class=\"cl-b5eaa378\"><span class=\"cl-b5e73cce\"></span></p></td><td class=\"cl-b5eab571\"><p class=\"cl-b5eaa378\"><span class=\"cl-b5e73cce\">(24.237)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b5eab571\"><p class=\"cl-b5eaa378\"><span class=\"cl-b5e73cce\">I(palter^2)</span></p></td><td class=\"cl-b5eab571\"><p class=\"cl-b5eaa378\"><span class=\"cl-b5e73cce\">-1.014</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b5eab571\"><p class=\"cl-b5eaa378\"><span class=\"cl-b5e73cce\"></span></p></td><td class=\"cl-b5eab571\"><p class=\"cl-b5eaa378\"><span class=\"cl-b5e73cce\">(0.360)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b5eab572\"><p class=\"cl-b5eaa378\"><span class=\"cl-b5e73cce\">Num.Obs.</span></p></td><td class=\"cl-b5eab572\"><p class=\"cl-b5eaa378\"><span class=\"cl-b5e73cce\">10202</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b5eab57a\"><p class=\"cl-b5eaa378\"><span class=\"cl-b5e73cce\">Std.Errors</span></p></td><td class=\"cl-b5eab57a\"><p class=\"cl-b5eaa378\"><span class=\"cl-b5e73cce\">by: pnr</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\n## Mehrebenenmodelle mit `{lme4}` {#mlvl}\n\n\nMit `lmer()` können wir ein Random Intercept Modell berechnen, indem wir mit `( 1 | pnr)` angeben, dass für `pnr` jeweils ein eigenes Random Intercept berechnet werden soll:\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lme4)\nml_m3 <- lmer(netges ~ palter + I(palter^2) + ( 1 | pnr), data=pend)\n\nmodelsummary(list(ml_m3),gof_omit = \"R|IC|Log|F\",output = \"flextable\")\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"tabwid\"><style>.cl-b71ed1f6{}.cl-b713fb50{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-b717b7a4{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-b717d90a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b717d914{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b717d91e{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-b71ed1f6'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-b717d90a\"><p class=\"cl-b717b7a4\"><span class=\"cl-b713fb50\"> </span></p></th><th class=\"cl-b717d90a\"><p class=\"cl-b717b7a4\"><span class=\"cl-b713fb50\">(1)</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b717d914\"><p class=\"cl-b717b7a4\"><span class=\"cl-b713fb50\">(Intercept)</span></p></td><td class=\"cl-b717d914\"><p class=\"cl-b717b7a4\"><span class=\"cl-b713fb50\">270.192</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b717d914\"><p class=\"cl-b717b7a4\"><span class=\"cl-b713fb50\"></span></p></td><td class=\"cl-b717d914\"><p class=\"cl-b717b7a4\"><span class=\"cl-b713fb50\">(340.781)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b717d914\"><p class=\"cl-b717b7a4\"><span class=\"cl-b713fb50\">palter</span></p></td><td class=\"cl-b717d914\"><p class=\"cl-b717b7a4\"><span class=\"cl-b713fb50\">42.585</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b717d914\"><p class=\"cl-b717b7a4\"><span class=\"cl-b713fb50\"></span></p></td><td class=\"cl-b717d914\"><p class=\"cl-b717b7a4\"><span class=\"cl-b713fb50\">(16.316)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b717d914\"><p class=\"cl-b717b7a4\"><span class=\"cl-b713fb50\">I(palter^2)</span></p></td><td class=\"cl-b717d914\"><p class=\"cl-b717b7a4\"><span class=\"cl-b713fb50\">-0.299</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b717d914\"><p class=\"cl-b717b7a4\"><span class=\"cl-b713fb50\"></span></p></td><td class=\"cl-b717d914\"><p class=\"cl-b717b7a4\"><span class=\"cl-b713fb50\">(0.187)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b717d914\"><p class=\"cl-b717b7a4\"><span class=\"cl-b713fb50\">SD (Intercept pnr)</span></p></td><td class=\"cl-b717d914\"><p class=\"cl-b717b7a4\"><span class=\"cl-b713fb50\">1645.723</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b717d914\"><p class=\"cl-b717b7a4\"><span class=\"cl-b713fb50\">SD (Observations)</span></p></td><td class=\"cl-b717d914\"><p class=\"cl-b717b7a4\"><span class=\"cl-b713fb50\">1601.131</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b717d91e\"><p class=\"cl-b717b7a4\"><span class=\"cl-b713fb50\">Num.Obs.</span></p></td><td class=\"cl-b717d91e\"><p class=\"cl-b717b7a4\"><span class=\"cl-b713fb50\">10202</span></p></td></tr></tbody></table></div>\n```\n:::\n:::\n\n\nMehr zu Mehrebenenmodellen und `{lme4}` in Blogposts von [Rense Nieuwenhuis ](http://www.rensenieuwenhuis.nl/r-sessions-16-multilevel-model-specification-lme4/) und [Tristan Mahr](https://www.tjmahr.com/plotting-partial-pooling-in-mixed-effects-models/).\n\n\n<!-- ## Abschließende Bemerkungen -->\n\n<!-- Zusammengefasst lassen uns `{fixest}` und `{modelsummary}` Standardfehler nach der eigentlichen Modellschätzung anpassen, indem wir die  `se` or `cluster` Optionen verwenden.  -->\n\n<!-- Ein [Blog Post von Grant Mcdermott](https://grantmcdermott.com/better-way-adjust-SEs/) argumentiert noch etwas ausführlicher, warum die nachträgliche Berechnung der Standardfehler (anstelle einer kompletten Neuschätzung des Modells) eine gute Idee ist - auch wenn es für Stata-Nutzende ein sehr ungewöhnliches Vorgehen ist. -->\n\n<!-- Die exakte Replikation von Standardfehlern aus anderen Programmen (bspw, Stata) ist oft schwieriger als es zunächst scheint.  -->\n<!-- Siehe auch die Diskussion [hier](https://github.com/sgaure/lfe/issues/1#issuecomment-530643808)  -->\n<!-- [Detaillierte vignette](https://lrberge.github.io/fixest/articles/standard_errors.html) `{fixest}` wie SEs aus anderen Programmen repliziert werden können. -->\n<!-- [Detailliertes Paper](http://sandwich.r-forge.r-project.org/articles/jss_2020.html) von den Autoren von `{sandwich}` zu diesem Thema.  -->\n\n## Anhang: Predictions mit `marginaleffects` und \"manuelle\" Darstellung\n\nWir hatten im Kapitel [Interaktionen](#interaktionen) folgendes Modell geschätzt:\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(m5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = var2 ~ var1 * g_fct, data = dat1)\n\nResiduals:\n      1       2       3       4       5       6       7       8 \n-1.5000  2.6145 -0.8827  4.5000 -7.3687 -1.5000  5.6369 -1.5000 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)  \n(Intercept)    -3.1117     4.7702  -0.652   0.5498  \nvar1            2.4972     0.8211   3.041   0.0384 *\ng_fctmen        5.9451     8.4973   0.700   0.5227  \nvar1:g_fctmen  -2.1639     1.5331  -1.411   0.2310  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 5.493 on 4 degrees of freedom\nMultiple R-squared:  0.7244,\tAdjusted R-squared:  0.5177 \nF-statistic: 3.504 on 3 and 4 DF,  p-value: 0.1286\n```\n:::\n:::\n\n\nMit `predictions()` aus `{marginaleffects}` können wir basierend auf unserem Modell vorhergesagte Werte für bestimmte Werte berechnen.\nDazu geben wir die die gewünschten mit einem `expand.grid()` an.\n\n::: {.cell}\n\n```{.r .cell-code}\n# Kombinationen aller Werte erstellen\nexpand.grid(var1 = 1:5, \n            g_fct =  c(\"women\",\"men\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   var1 g_fct\n1     1 women\n2     2 women\n3     3 women\n4     4 women\n5     5 women\n6     1   men\n7     2   men\n8     3   men\n9     4   men\n10    5   men\n```\n:::\n:::\n\n\nDiese Werte geben wir dann in `predictions()` als `newdata =` an:\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(marginaleffects)\np <- predictions(m5, \n                 newdata = expand.grid(var1 = 1:5,\n                                       g_fct =  c(\"women\",\"men\")) )\n                 \nhead(data.frame(p))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  rowid   estimate std.error  statistic      p.value  conf.low conf.high var1\n1     1 -0.6145251  4.126052 -0.1489378 0.8816027065 -8.701438  7.472388    1\n2     2  1.8826816  3.555532  0.5295076 0.5964533448 -5.086034  8.851397    2\n3     3  4.3798883  3.099641  1.4130307 0.1576466975 -1.695297 10.455074    3\n4     4  6.8770950  2.814641  2.4433298 0.0145524331  1.360501 12.393689    4\n5     5  9.3743017  2.754104  3.4037579 0.0006646564  3.976358 14.772245    5\n6     6  3.1666667  5.861938  0.5402082 0.5890534765 -8.322520 14.655853    1\n  g_fct var2\n1 women    2\n2 women    2\n3 women    2\n4 women    2\n5 women    2\n6   men    2\n```\n:::\n:::\n\n\nFür den `ggplot()` verwenden wir dann `geom_line()` zusammen mit \n\n+ `geom_errorbar()` für eine Darstellung mit Konfidenzintervallen als Error Bars \n+ mit `geom_ribbon()` erhalten wir die Konfidenzintervalle als Konfidenzbänder (hier müssen wir mit `alpha = ` die Deckkraft der etwas heruntersetzen und die Farbe mit `fill=` angeben um den Bereich einzufärben). \n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\npred_plt <- \n    ggplot(data= data.frame(p),\n           aes(x = var1, \n               y =  estimate, \n               ymin = conf.low,ymax = conf.high,\n               color = g_fct)) + \n      geom_line() + \n      scale_color_manual(values = c(\"orange\",\"lightskyblue3\"),breaks = c(\"women\",\"men\"),labels=c(\"Frauen\",\"Männer\")) +\n      labs(title = \"Vorhergesagte Werte für var2\",\n           color = \"Gender\",\n           x = \"Werte für var1\",\n           y = \"Vorhergesagte Werte für var1\") +\n      theme_minimal()\n\n# Konfidenzintervalle\npred_plt + \n  geom_point(size = 2.75) +\n  geom_errorbar(width = .1)\n```\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-29-1.png){width=3500}\n:::\n\n```{.r .cell-code}\n# mit Konfidenzbändern\npred_plt + \n  geom_ribbon(alpha = .1, color = NA,aes(fill = g_fct)) +\n  scale_fill_manual(values = c(\"orange\",\"lightskyblue3\"),breaks = c(\"women\",\"men\"),labels=c(\"Frauen\",\"Männer\")) +\n  labs(fill = \"Gender\")\n```\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-29-2.png){width=3500}\n:::\n:::\n",
    "supporting": [
      "09_reg2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/tabwid-1.1.3/tabwid.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/tabwid-1.1.3/tabwid.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}